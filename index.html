// Gerar relat√≥rio ATUALIZADO (com fotos integradas)
        function gerarRelatorio() {
            try {
                if (!validarFormulario()) return;

                const form = document.getElementById('fiscalizacaoForm');
                if (!form) throw new Error('Formul√°rio n√£o encontrado');

                const formData = new FormData(form);
                const dados = Object.fromEntries(formData.entries());

                // Obter dados dos checkboxes
                const servicosSelecionados = Array.from(document.querySelectorAll('input[name="tipoServico"]:checked'))
                    .map(cb => cb.value);
                const formasAcesso = Array.from(document.querySelectorAll('input[name="formasAcesso"]:checked'))
                    .map(cb => cb.value);
                const especialidades = Array.from(document.querySelectorAll('input[name="especialidades"]:checked'))
                    .map(cb => cb.value);

                // NOVO: Gerar se√ß√£o de fotos se existirem
                let secaoFotos = '';
                const totalFotos = Object.values(fotosFiscalizacao).reduce((acc, arr) => acc + arr.length, 0);
                
                if (totalFotos > 0) {
                    secaoFotos = `
                        <h3>üì∏ 2.15. DOCUMENTA√á√ÉO FOTOGR√ÅFICA</h3>
                        <p><strong>Total de fotos anexadas:</strong> ${totalFotos}</p>
                    `;
                    
                    Object.keys(fotosFiscalizacao).forEach(categoria => {
                        if (fotosFiscalizacao[categoria].length > 0) {
                            secaoFotos += `
                                <h4>${getCategoriaName(categoria)}</h4>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
                            `;
                            
                            });
                            
                            secaoFotos += '</div>';
                        }
                    });
                }

                let relatorio = `
                    <div style="page-break-after: always;">
                        <p style="text-align: center; margin-bottom: 30px;"><strong>Seja o presente voto submetido √† delibera√ß√£o da plen√°ria.</strong></p>
                        
                        <h3>ESTE VOTO ANALISAR√Å O SEGUINTE SERVI√áO:</h3>
                        <ul>
                            ${servicosSelecionados.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                        
                        <h3>1. DOCUMENTOS DISPONIBILIZADOS:</h3>
                        <p><strong>Parecer(s) T√©cnico(s) n¬∫:</strong> ${dados.pareceres_tecnicos || '_'.repeat(50)}</p>
                        <p><strong>Nota(s) T√©cnica(s) n¬∫:</strong> ${dados.notas_tecnicas || '_'.repeat(50)}</p>
                        <p><strong>Plano de A√ß√£o Ano:</strong> ${dados.plano_acao_ano || '____'} &nbsp;&nbsp;&nbsp; <strong>Relat√≥rio de Atividades Ano:</strong> ${dados.relatorio_atividades_ano || '____'}</p>
                        
                        <h3>2. DA VISITA</h3>
                        <p><strong>Nome da Entidade Visitada:</strong> ${dados.nome_entidade || '____'}</p>
                        <p><strong>CNPJ:</strong> ${dados.cnpj_entidade || '____'}</p>
                        <p><strong>2.1. Data:</strong> ${dados.data_visita ? new Date(dados.data_visita).toLocaleDateString('pt-BR') : '____'}</p>
                        <p><strong>2.2. Hor√°rio:</strong> ${dados.horario_visita === 'matutino' ? '‚òë matutino ‚òê vespertino' : '‚òê matutino ‚òë vespertino'}</p>
                        <p><strong>2.3. Nome de quem recebeu o conselheiro na institui√ß√£o:</strong> ${dados.nome_recebeu || '____'}<br>
                        <strong>Fun√ß√£o:</strong> ${dados.funcao_recebeu || '____'}</p>
                        
                        <h4>2.4. Endere√ßo(s) visitado(s):</h4>
                        ${dados.endereco_1 ? `<p><strong>1:</strong> ${dados.endereco_1} - Licen√ßa de Funcionamento: ${dados.licenca_1 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        ${dados.endereco_2 ? `<p><strong>2:</strong> ${dados.endereco_2} - Licen√ßa de Funcionamento: ${dados.licenca_2 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        ${dados.endereco_3 ? `<p><strong>3:</strong> ${dados.endereco_3} - Licen√ßa de Funcionamento: ${dados.licenca_3 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        
                        <h4>2.5. P√∫blico-alvo:</h4>
                        <table border="1" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <tr><th>P√∫blico</th><th>CDI/DF</th><th>CDCA/DF</th></tr>
                            <tr><td>Pessoas idosas (mais de 60 anos)</td><td>${dados.cdi_idosos === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td><td>n√£o se aplica</td></tr>
                            <tr><td>Crian√ßas e adolescentes (at√© 18 anos)</td><td>n√£o se aplica</td><td>${dados.cdca_criancas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td></tr>
                            <tr><td>Fam√≠lias</td><td>${dados.cdi_familias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td><td>${dados.cdca_familias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td></tr>
                            <tr><td>Adultos (entre 18 a 59 anos)</td><td>n√£o se aplica</td><td>n√£o se aplica</td></tr>
                        </table>
                        
                        <h4>2.6. Formas de acesso dos usu√°rios nos servi√ßos/a√ß√µes:</h4>
                        <ul>
                            ${formasAcesso.map(forma => `<li>‚òë ${forma}</li>`).join('')}
                            ${dados.outras_formas ? `<li>‚òë Outros: ${dados.outras_formas}</li>` : ''}
                        </ul>
                        
                        <h4>2.7. Equipe de profissionais:</h4>
                        <p><strong>N¬∫ de volunt√°rios:</strong> ${dados.num_voluntarios || '____'} &nbsp;&nbsp;&nbsp; <strong>N¬∫ de contratados:</strong> ${dados.num_contratados || '____'}</p>
                        
                        <h4>2.8. Especialidades que atuam na oferta socioassistencial:</h4>
                        <ul>
                            ${especialidades.map(esp => `<li>‚òë ${esp}</li>`).join('')}
                            ${dados.outras_especialidades ? `<li>‚òë outros: ${dados.outras_especialidades}</li>` : ''}
                        </ul>
                        
                        <h4>2.9. Infraestrutura:</h4>
                        <p><strong>a) O Espa√ßo √©:</strong> ${dados.tipo_espaco === 'pr√≥prio' ? '‚òë pr√≥prio' : '‚òê pr√≥prio'} ${dados.tipo_espaco === 'alugado' ? '‚òë alugado' : '‚òê alugado'} ${dados.tipo_espaco === 'cedido' ? '‚òë cedido' : '‚òê cedido'}</p>
                        <p><strong>b) Atende aos crit√©rios de acessibilidade?</strong> ${dados.acessibilidade === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_acessibilidade ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_acessibilidade}</p>` : ''}
                        <p><strong>c) Compartilha o espa√ßo com outros servi√ßos?</strong> ${dados.compartilha_espaco === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_compartilhamento ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_compartilhamento}</p>` : ''}
                        <p><strong>d) O espa√ßo atende de forma satisfat√≥ria a execu√ß√£o da oferta socioassistencial?</strong> ${dados.espaco_satisfatorio === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_espaco ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_espaco}</p>` : ''}
                        
                        <h4>2.10. Do car√°ter cont√≠nuo e permanente:</h4>
                        <p><strong>a) Possui atividades de Dezembro a Dezembro?</strong> ${dados.atividades_continuas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        <p><strong>b) Possui recesso/f√©rias coletivas?</strong> ${dados.recesso_ferias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        
                        <h4>2.11. As a√ß√µes ofertadas s√£o totalmente gratuitas?</h4>
                        <p>${dados.acoes_gratuitas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.especificar_nao_gratuitas ? `<p><strong>Especifique:</strong> ${dados.especificar_nao_gratuitas}</p>` : ''}
                        ${dados.especificar_bpc ? `<p><strong>Recebe BPC. Especifique:</strong> ${dados.especificar_bpc}</p>` : ''}
                        
                        <h4>2.12. As a√ß√µes efetivamente executadas correspondem √† oferta para a qual possui inscri√ß√£o?</h4>
                        <p>${dados.acoes_correspondem === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_acoes_correspondem ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_acoes_correspondem}</p>` : ''}
                        
                        <h4>2.13. Articula√ß√£o com a rede setorial SUAS e outras redes:</h4>
                        <table border="1" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <tr><th>Rede</th><th>Sim</th><th>N√£o</th><th>Observa√ß√µes</th></tr>
                            <tr><td>CRAS</td><td>${dados.articulacao_cras === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_cras === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_cras || ''}</td></tr>
                            <tr><td>CREAS</td><td>${dados.articulacao_creas === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_creas === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_creas || ''}</td></tr>
                            <tr><td>Sa√∫de</td><td>${dados.articulacao_saude === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_saude === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_saude || ''}</td></tr>
                            <tr><td>Educa√ß√£o</td><td>${dados.articulacao_educacao === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_educacao === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_educacao || ''}</td></tr>
                            <tr><td>Habita√ß√£o</td><td>${dados.articulacao_habitacao === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_habitacao === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_habitacao || ''}</td></tr>
                            <tr><td>Trabalho e Renda</td><td>${dados.articulacao_trabalho === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_trabalho === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_trabalho || ''}</td></tr>
                            <tr><td>Sistema de Justi√ßa</td><td>${dados.articulacao_justica === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_justica === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_justica || ''}</td></tr>
                        </table>
                        
                        <h4>2.14. A forma de execu√ß√£o (metodologia) das a√ß√µes atende √†s diretrizes das regulamenta√ß√µes?</h4>
                        <p>${dados.metodologia_adequada === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_metodologia ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_metodologia}</p>` : ''}
                        
                        ${secaoFotos}
                        
                        <h3>3. DO VOTO</h3>
                        <p><strong>3.1. Quanto √†s an√°lises t√©cnicas elaboradas pela Secretaria Executiva, o Relator:</strong></p>
                        <p>${dados.concordancia_analises === 'concorda' ? '‚òë concorda ‚òê discorda' : '‚òê concorda ‚òë discorda'}</p>
                        ${dados.fundamentos_discordancia ? `<p><strong>Fundamentos:</strong> ${dados.fundamentos_discordancia}</p>` : ''}
                        
                        <p><strong>3.2. O(A) Conselheiro(a) vota pelo(a):</strong></p>
                        <p>${dados.voto_final === 'Indeferimento do pedido quanto √† oferta analisada' ? '‚òë' : '‚òê'} Indeferimento do pedido quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Deferimento do pedido quanto √† oferta analisada' ? '‚òë' : '‚òê'} Deferimento do pedido quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada' ? '‚òë' : '‚òê'} Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Cancelamento da inscri√ß√£o quanto √† oferta analisada' ? '‚òë' : '‚òê'} Cancelamento da inscri√ß√£o quanto √† oferta analisada</p>
                        
                        <div style="margin-top: 40px; padding: 20px; border: 2px solid #48bb78; border-radius: 10px; background: #f0fff4;">
                            <h4 style="color: #38a169;">‚úÖ DOCUMENTO OFICIAL CAS-DF</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 12px; margin: 15px 0;">
                                <p><strong>N√∫mero do Documento:</strong> ${numeroDocumento}</p>
                                <p><strong>Data/Hora de Assinatura:</strong> ${document.getElementById('signatureDateTime')?.textContent || 'N/A'}</p>
                                <p><strong>Conselheiro Respons√°vel:</strong> ${dados.nome_conselheiro}</p>
                                <p><strong>CPF:</strong> ${dados.cpf_conselheiro}</p>
                                <p><strong>Entidade Fiscalizada:</strong> ${dados.nome_entidade}</p>
                                <p><strong>CNPJ:</strong> ${dados.cnpj_entidade}</p>
                            </div>
                            <p style="font-size: 11px; margin: 10px 0;"><strong>Hash de Verifica√ß√£o:</strong> ${hashDocumento}</p>
                            <p style="font-size: 10px; color: #666; margin: 10px 0; text-align: center;">
                                Este documento foi assinado digitalmente e possui validade legal conforme MP 2.200-2/2001
                            </p>
                        </div>
                        
                        <div style="margin-top: 40px;">
                            <p><strong>Seja o presente voto submetido √† delibera√ß√£o da plen√°ria.</strong></p>
                            <p style="margin-top: 30px;">${dados.data_voto ? new Date(dados.data_voto).toLocaleDateString('pt-BR') : '____'}</p>
                            <div style="margin-top: 50px; border-top: 1px solid black; width: 300px; text-align: center;">
                                <p>${dados.nome_conselheiro}</p>
                                <p>Conselheiro(a)</p>
                            </div>
                        </div>
                    </div>
                `;

                const reportContentEl = document.getElementById('reportContent');
                const reportSectionEl = document.getElementById('reportSection');
                const formEl = document.getElementById('fiscalizacaoForm');

                if (reportContentEl) reportContentEl.innerHTML = relatorio;
                if (reportSectionEl) reportSectionEl.style.display = 'block';
                if (formEl) formEl.style.display = 'none';
                
                // Scroll para o topo do relat√≥rio
                if (reportSectionEl) {
                    reportSectionEl.scrollIntoView({ behavior: 'smooth' });
                }

                mostrarNotificacao('Relat√≥rio gerado com sucesso!' + (totalFotos > 0 ? ` (${totalFotos} fotos inclu√≠das)` : ''), 'success');
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                mostrarNotificacao('Erro ao gerar relat√≥rio. Tente novamente.', 'error');
            }
        }

        console.log('üí° Execute verificarSistema() para fazer uma verifica√ß√£o completa');
        console.log('üì∏ M√≥dulo de fotos carregado! Use as fun√ß√µes de captura na se√ß√£o 2.15');<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Fiscaliza√ß√£o CAS-DF - Vers√£o Corrigida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e1e8ed;
            border-radius: 15px;
            background: #f8fafc;
        }

        .form-section h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
        }

        .checkbox-item input[type="checkbox"], .checkbox-item input[type="radio"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .form-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        .form-table th,
        .form-table td {
            border: 1px solid #e2e8f0;
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
        }

        .form-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        .form-table td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .endereco-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
        }

        .articulacao-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin: 5px 0;
            background: white;
        }

        .articulacao-header {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .content {
                padding: 15px;
            }
            
            .form-section {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .btn {
                width: 100%;
                max-width: 300px;
                padding: 12px 20px;
                font-size: 14px;
            }

            .articulacao-grid {
                grid-template-columns: 1fr;
                text-align: left;
                gap: 5px;
            }
            
            .articulacao-grid > div:first-child {
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .form-table {
                font-size: 12px;
            }
            
            .form-table th,
            .form-table td {
                padding: 6px 4px;
            }
            
            .endereco-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .endereco-item input[type="text"] {
                width: 100%;
                margin: 5px 0;
            }
            
            .endereco-item label {
                margin: 2px 0;
            }
            
            /* Melhor formata√ß√£o da se√ß√£o de servi√ßos em mobile */
            .form-section div[style*="border: 2px solid #333"] {
                padding: 10px !important;
            }
            
            .form-section div[style*="display: grid; grid-template-columns: 1fr 1fr"] {
                display: block !important;
                border-bottom: 1px solid #333;
                padding: 10px 0;
            }
            
            .form-section div[style*="border-right: 1px solid #333"] {
                border-right: none !important;
                border-bottom: 1px solid #ccc;
                padding-bottom: 10px;
                margin-bottom: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 15px;
                max-height: 90vh;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                top: 10px;
                transform: translateY(-100%);
                transition: all 0.3s ease;
            }
            
            .notification.show {
                transform: translateY(0);
            }
            
            /* Melhor visualiza√ß√£o dos checkboxes em mobile */
            input[type="checkbox"], input[type="radio"] {
                transform: scale(1.5);
                margin-right: 12px;
            }
            
            label {
                line-height: 1.6;
                padding: 5px 0;
            }
            
            /* Assinatura digital responsiva */
            div[style*="background: white; padding: 25px"] {
                padding: 15px !important;
            }
            
            .form-group input, .form-group textarea, .form-group select {
                font-size: 16px; /* Evita zoom no iOS */
            }
        }

        /* === ESTILOS PARA M√ìDULO DE FOTOS (NOVO) === */
        .categoria-fotos {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e8f5e8;
            border-radius: 8px;
            background: #fafffe;
        }

        .fotos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
            min-height: 40px;
            border: 2px dashed #c8e6c9;
            border-radius: 8px;
            padding: 10px;
        }

        .fotos-grid:empty::before {
            content: "üì∑ Nenhuma foto adicionada";
            display: flex;
            align-items: center;
            justify-content: center;
            color: #81c784;
            font-size: 14px;
            height: 40px;
        }

        .foto-item {
            position: relative;
            border: 2px solid #4caf50;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
            background: #f5f5f5;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .foto-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .foto-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .foto-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 12px;
            text-align: center;
            padding: 5px;
        }

        .foto-item:hover .foto-overlay {
            opacity: 1;
        }

        .foto-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 3px;
        }

        .foto-btn {
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 4px 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }

        .foto-btn:hover {
            background: rgba(244, 67, 54, 0.9);
        }

        .btn-mini {
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 15px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .btn-mini:hover {
            background: #45a049;
        }

        .foto-contador {
            background: #e8f5e8;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        /* Responsivo para fotos */
        @media (max-width: 768px) {
            .fotos-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 8px;
            }

            .categoria-fotos {
                padding: 10px;
                margin: 15px 0;
            }

            .foto-overlay {
                font-size: 10px;
                padding: 3px;
            }

            div[style*="display: flex; gap: 10px"] {
                flex-direction: column;
                align-items: center;
            }

            div[style*="display: flex; gap: 10px"] button {
                width: 100%;
                max-width: 250px;
            }

            #contador-fotos {
                align-self: center !important;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL</h1>
            <p>SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF - CEP 70.770-502</p>
            <p>E-mail: Cas_df@sedes.df.gov.br</p>
        </div>

        <div class="content">
            <form id="fiscalizacaoForm">
                <!-- Este voto analisar√° o seguinte servi√ßo -->
                <div class="form-section">
                    <h3>üìã Este voto analisar√° o seguinte servi√ßo:</h3>
                    <div style="border: 2px solid #333; padding: 20px;">
                        <!-- Primeira linha -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid #333;">
                            <div style="padding: 10px; border-right: 1px solid #333;">
                                <label><input type="checkbox" id="acoes_assessoramento" name="tipoServico" value="1. A√ß√µes de Assessoramento"> <strong>1. A√ß√µes de Assessoramento</strong></label>
                            </div>
                            <div style="padding: 10px;">
                                <div style="font-weight: bold;">6. Servi√ßo de Prote√ß√£o Social B√°sica no domic√≠lio para:</div>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="protecao_basica_deficientes" name="tipoServico" value="6. Servi√ßo de Prote√ß√£o Social B√°sica no domic√≠lio para pessoas com defici√™ncia"> pessoas com defici√™ncia</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="protecao_basica_idosos" name="tipoServico" value="6. Servi√ßo de Prote√ß√£o Social B√°sica no domic√≠lio para pessoas idosas"> pessoas idosas</label>
                            </div>
                        </div>
                        
                        <!-- Segunda linha -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid #333;">
                            <div style="padding: 10px; border-right: 1px solid #333;">
                                <label><input type="checkbox" id="acoes_defesa" name="tipoServico" value="2. A√ß√µes de Defesa e Garantia de Direitos"> <strong>2. A√ß√µes de Defesa e Garantia de Direitos</strong></label>
                            </div>
                            <div style="padding: 10px;">
                                <div style="font-weight: bold;">7. Servi√ßo de Prote√ß√£o Social Especial para:</div>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="protecao_especial_deficientes" name="tipoServico" value="7. Servi√ßo de Prote√ß√£o Social Especial para pessoas com defici√™ncia e suas fam√≠lias"> pessoas com defici√™ncia e suas fam√≠lias</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="protecao_especial_idosos" name="tipoServico" value="7. Servi√ßo de Prote√ß√£o Social Especial para pessoas idosas e suas fam√≠lias"> pessoas idosas e suas fam√≠lias</label>
                            </div>
                        </div>
                        
                        <!-- Terceira linha -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid #333;">
                            <div style="padding: 10px; border-right: 1px solid #333;">
                                <label><input type="checkbox" id="promocao_integracao" name="tipoServico" value="3. Promo√ß√£o da integra√ß√£o ao mundo do trabalho"> <strong>3. Promo√ß√£o da integra√ß√£o ao mundo do trabalho</strong></label>
                            </div>
                            <div style="padding: 10px;">
                                <label><input type="checkbox" id="abordagem_social" name="tipoServico" value="8. Servi√ßo de Abordagem Social"> <strong>8. Servi√ßo de Abordagem Social</strong></label>
                            </div>
                        </div>
                        
                        <!-- Quarta linha -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid #333;">
                            <div style="padding: 10px; border-right: 1px solid #333;">
                                <div style="font-weight: bold;">4. Servi√ßo de Conviv√™ncia e Fortalecimento de V√≠nculos para:</div>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="servico_convivencia_criancas" name="tipoServico" value="4. Servi√ßo de Conviv√™ncia e Fortalecimento de V√≠nculos para crian√ßas e adolescentes"> crian√ßas e adolescentes,</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="servico_convivencia_jovens" name="tipoServico" value="4. Servi√ßo de Conviv√™ncia e Fortalecimento de V√≠nculos para jovens e adultos"> jovens e adultos</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="servico_convivencia_idosos" name="tipoServico" value="4. Servi√ßo de Conviv√™ncia e Fortalecimento de V√≠nculos para pessoas idosas"> pessoas idosas</label>
                            </div>
                            <div style="padding: 10px;">
                                <div style="font-weight: bold;">9. Servi√ßo de Acolhimento na modalidade:</div>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_abrigo" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Abrigo Institucional"> Abrigo Institucional;</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_casa_lar" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Casa-Lar"> Casa-Lar;</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_casa_passagem" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Casa de Passagem"> Casa de Passagem;</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_residencia" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Resid√™ncia Inclusiva"> Resid√™ncia Inclusiva</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_republica" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Rep√∫blica"> Rep√∫blica</label><br>
                                <label style="margin-left: 20px; font-weight: normal;"><input type="checkbox" id="acolhimento_familia" name="tipoServico" value="9. Servi√ßo de Acolhimento na modalidade Fam√≠lia Acolhedora"> Fam√≠lia Acolhedora</label>
                            </div>
                        </div>
                        
                        <!-- Quinta linha -->
                        <div style="padding: 10px;">
                            <label><input type="checkbox" id="acoes_integracao_deficiencia" name="tipoServico" value="5. A√ß√µes de integra√ß√£o √† vida comunit√°ria da pessoa com defici√™ncia"> <strong>5. A√ß√µes de integra√ß√£o √† vida comunit√°ria da pessoa com defici√™ncia</strong></label>
                        </div>
                    </div>
                </div>

                <!-- 1. DOCUMENTOS DISPONIBILIZADOS -->
                <div class="form-section">
                    <h3>üìÑ 1. DOCUMENTOS DISPONIBILIZADOS:</h3>
                    <div class="form-group">
                        <label for="pareceres_tecnicos">Parecer(s) T√©cnico(s) n¬∫:</label>
                        <input type="text" id="pareceres_tecnicos" name="pareceres_tecnicos">
                    </div>
                    <div class="form-group">
                        <label for="notas_tecnicas">Nota(s) T√©cnica(s) n¬∫:</label>
                        <input type="text" id="notas_tecnicas" name="notas_tecnicas">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="plano_acao_ano">Plano de A√ß√£o Ano:</label>
                            <input type="number" id="plano_acao_ano" name="plano_acao_ano" min="2020" max="2030">
                        </div>
                        <div class="form-group">
                            <label for="relatorio_atividades_ano">Relat√≥rio de Atividades Ano:</label>
                            <input type="number" id="relatorio_atividades_ano" name="relatorio_atividades_ano" min="2020" max="2030">
                        </div>
                    </div>
                </div>

                <!-- 2. DA VISITA -->
                <div class="form-section">
                    <h3>üè¢ 2. DA VISITA</h3>
                    
                    <!-- NOVOS CAMPOS: Nome da Entidade e CNPJ -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome_entidade">Nome da Entidade Visitada:</label>
                            <input type="text" id="nome_entidade" name="nome_entidade" required>
                        </div>
                        <div class="form-group">
                            <label for="cnpj_entidade">CNPJ:</label>
                            <input type="text" id="cnpj_entidade" name="cnpj_entidade" placeholder="00.000.000/0000-00" maxlength="18" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data_visita">2.1. Data:</label>
                            <input type="date" id="data_visita" name="data_visita" required>
                        </div>
                        <div class="form-group">
                            <label>2.2. Hor√°rio:</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="horario_visita" value="matutino">
                                    matutino
                                </label>
                                <label>
                                    <input type="radio" name="horario_visita" value="vespertino">
                                    vespertino
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome_recebeu">2.3. Nome de quem recebeu o conselheiro na institui√ß√£o:</label>
                            <input type="text" id="nome_recebeu" name="nome_recebeu" required>
                        </div>
                        <div class="form-group">
                            <label for="funcao_recebeu">Fun√ß√£o:</label>
                            <input type="text" id="funcao_recebeu" name="funcao_recebeu" required>
                        </div>
                    </div>

                    <!-- 2.4. Endere√ßo(s) visitado(s) -->
                    <div class="form-group">
                        <label>2.4. Endere√ßo(s) visitado(s):</label>
                        <div id="enderecosContainer">
                            <div class="endereco-item">
                                <span style="font-weight: 600;">1:</span>
                                <input type="text" name="endereco_1" placeholder="Digite o endere√ßo visitado" style="flex: 1;">
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_1" value="sim"> Sim
                                </label>
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_1" value="nao"> N√£o
                                </label>
                                <span style="font-size: 14px; color: #666;">Licen√ßa de Funcionamento</span>
                            </div>
                            <div class="endereco-item">
                                <span style="font-weight: 600;">2:</span>
                                <input type="text" name="endereco_2" placeholder="Digite o endere√ßo visitado" style="flex: 1;">
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_2" value="sim"> Sim
                                </label>
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_2" value="nao"> N√£o
                                </label>
                                <span style="font-size: 14px; color: #666;">Licen√ßa de Funcionamento</span>
                            </div>
                            <div class="endereco-item">
                                <span style="font-weight: 600;">3:</span>
                                <input type="text" name="endereco_3" placeholder="Digite o endere√ßo visitado" style="flex: 1;">
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_3" value="sim"> Sim
                                </label>
                                <label style="margin: 0;">
                                    <input type="radio" name="licenca_3" value="nao"> N√£o
                                </label>
                                <span style="font-size: 14px; color: #666;">Licen√ßa de Funcionamento</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2.5. P√∫blico-alvo -->
                    <div class="form-group">
                        <label>2.5. P√∫blico-alvo:</label>
                        <div class="table-container">
                            <table class="form-table">
                                <thead>
                                    <tr>
                                        <th>P√∫blico</th>
                                        <th>Possui registro no Conselho do Idoso - CDI/DF?</th>
                                        <th>Possui registro no Conselho da Crian√ßa e Adolesc - CDCA/DF?</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Pessoas idosas (mais de 60 anos)</td>
                                        <td>
                                            <label><input type="radio" name="cdi_idosos" value="sim"> sim</label>
                                            <label><input type="radio" name="cdi_idosos" value="nao"> n√£o</label>
                                        </td>
                                        <td>n√£o se aplica</td>
                                    </tr>
                                    <tr>
                                        <td>Crian√ßas e adolescentes (at√© 18 anos)</td>
                                        <td>n√£o se aplica</td>
                                        <td>
                                            <label><input type="radio" name="cdca_criancas" value="sim"> sim</label>
                                            <label><input type="radio" name="cdca_criancas" value="nao"> n√£o</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Fam√≠lias</td>
                                        <td>
                                            <label><input type="radio" name="cdi_familias" value="sim"> sim</label>
                                            <label><input type="radio" name="cdi_familias" value="nao"> n√£o</label>
                                        </td>
                                        <td>
                                            <label><input type="radio" name="cdca_familias" value="sim"> sim</label>
                                            <label><input type="radio" name="cdca_familias" value="nao"> n√£o</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Adultos (entre 18 a 59 anos)</td>
                                        <td>n√£o se aplica</td>
                                        <td>n√£o se aplica</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 2.6. Formas de acesso dos usu√°rios -->
                    <div class="form-group">
                        <label>2.6. Formas de acesso dos usu√°rios nos servi√ßos/a√ß√µes:</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="procura_espontanea" name="formasAcesso" value="Procura espont√¢nea">
                                <label for="procura_espontanea">Procura espont√¢nea</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="busca_ativa" name="formasAcesso" value="Busca ativa">
                                <label for="busca_ativa">Busca ativa</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enc_secretaria" name="formasAcesso" value="Encaminhamento da Secretaria de Assist√™ncia Social do Distrito Federal">
                                <label for="enc_secretaria">Encaminhamento da Secretaria de Assist√™ncia Social do Distrito Federal</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enc_cras" name="formasAcesso" value="Encaminhamento do CRAS">
                                <label for="enc_cras">Encaminhamento do CRAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enc_creas" name="formasAcesso" value="Encaminhamento do CREAS">
                                <label for="enc_creas">Encaminhamento do CREAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enc_conselhos" name="formasAcesso" value="Encaminhamento de Conselhos de Defesa de Direitos">
                                <label for="enc_conselhos">Encaminhamento de Conselhos de Defesa de Direitos</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enc_politicas" name="formasAcesso" value="Encaminhamento pelas demais pol√≠ticas p√∫blicas">
                                <label for="enc_politicas">Encaminhamento pelas demais pol√≠ticas p√∫blicas</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="det_judicial" name="formasAcesso" value="Por determina√ß√£o judicial">
                                <label for="det_judicial">Por determina√ß√£o judicial</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="outras_formas">Outros:</label>
                            <input type="text" id="outras_formas" name="outras_formas" placeholder="Especifique outras formas de acesso">
                        </div>
                    </div>

                    <!-- 2.7. Equipe de profissionais -->
                    <div class="form-group">
                        <label>2.7. Equipe de profissionais:</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="num_voluntarios">N¬∫ de volunt√°rios:</label>
                                <input type="number" id="num_voluntarios" name="num_voluntarios" min="0">
                            </div>
                            <div class="form-group">
                                <label for="num_contratados">N¬∫ de contratados:</label>
                                <input type="number" id="num_contratados" name="num_contratados" min="0">
                            </div>
                        </div>
                    </div>

                    <!-- 2.8. Especialidades -->
                    <div class="form-group">
                        <label>2.8. Especialidades que atuam na oferta socioassistencial em an√°lise:</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="assistente_social" name="especialidades" value="assistente social">
                                <label for="assistente_social">assistente social</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="psicologo" name="especialidades" value="psic√≥logo">
                                <label for="psicologo">psic√≥logo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pedagogo" name="especialidades" value="pedagogo">
                                <label for="pedagogo">pedagogo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="terapeuta" name="especialidades" value="terapeuta ocupacional">
                                <label for="terapeuta">terapeuta ocupacional</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prof_direito" name="especialidades" value="profissional do direito">
                                <label for="prof_direito">profissional do direito</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cuidador" name="especialidades" value="cuidador social (n√≠vel m√©dio)">
                                <label for="cuidador">cuidador social (n√≠vel m√©dio)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="aux_admin" name="especialidades" value="auxiliar administrativo (n√≠vel m√©dio)">
                                <label for="aux_admin">auxiliar administrativo (n√≠vel m√©dio)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="agente_social" name="especialidades" value="agente social (n√≠vel m√©dio)">
                                <label for="agente_social">agente social (n√≠vel m√©dio)</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="outras_especialidades">outros:</label>
                            <input type="text" id="outras_especialidades" name="outras_especialidades" placeholder="Especifique outras especialidades">
                        </div>
                    </div>

                    <!-- 2.9. Infraestrutura -->
                    <div class="form-group">
                        <label>2.9. Infraestrutura:</label>
                        
                        <div class="form-group">
                            <label>a) O Espa√ßo √©:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="tipo_espaco" value="pr√≥prio"> pr√≥prio</label>
                                <label><input type="radio" name="tipo_espaco" value="alugado"> alugado</label>
                                <label><input type="radio" name="tipo_espaco" value="cedido"> cedido</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>b) Atende aos crit√©rios de acessibilidade?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="acessibilidade" value="sim"> sim</label>
                                <label><input type="radio" name="acessibilidade" value="nao"> n√£o</label>
                            </div>
                            <div class="form-group">
                                <label for="obs_acessibilidade">Observa√ß√µes:</label>
                                <textarea id="obs_acessibilidade" name="obs_acessibilidade" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>c) Compartilha o espa√ßo com outros servi√ßos?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="compartilha_espaco" value="sim"> sim</label>
                                <label><input type="radio" name="compartilha_espaco" value="nao"> n√£o</label>
                            </div>
                            <div class="form-group">
                                <label for="obs_compartilhamento">Observa√ß√µes:</label>
                                <textarea id="obs_compartilhamento" name="obs_compartilhamento" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>d) O espa√ßo atende de forma satisfat√≥ria a execu√ß√£o da oferta socioassistencial?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="espaco_satisfatorio" value="sim"> sim</label>
                                <label><input type="radio" name="espaco_satisfatorio" value="nao"> n√£o</label>
                            </div>
                            <div class="form-group">
                                <label for="obs_espaco">Observa√ß√µes:</label>
                                <textarea id="obs_espaco" name="obs_espaco" rows="3"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 2.10. Do car√°ter cont√≠nuo e permanente -->
                    <div class="form-group">
                        <label>2.10. Do car√°ter cont√≠nuo e permanente:</label>
                        
                        <div class="form-group">
                            <label>a) Possui atividades de Dezembro a Dezembro?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="atividades_continuas" value="sim"> sim</label>
                                <label><input type="radio" name="atividades_continuas" value="nao"> n√£o</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>b) Possui recesso/f√©rias coletivas?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="recesso_ferias" value="sim"> sim</label>
                                <label><input type="radio" name="recesso_ferias" value="nao"> n√£o</label>
                            </div>
                        </div>
                    </div>

                    <!-- 2.11. A√ß√µes gratuitas -->
                    <div class="form-group">
                        <label>2.11. As a√ß√µes ofertadas s√£o totalmente gratuitas?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="acoes_gratuitas" value="sim"> sim</label>
                            <label><input type="radio" name="acoes_gratuitas" value="nao"> n√£o</label>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="especificar_nao_gratuitas">Se n√£o, especifique:</label>
                                <input type="text" id="especificar_nao_gratuitas" name="especificar_nao_gratuitas">
                            </div>
                            <div class="form-group">
                                <label for="especificar_bpc">Recebe BPC. Especifique:</label>
                                <input type="text" id="especificar_bpc" name="especificar_bpc">
                            </div>
                        </div>
                    </div>

                    <!-- 2.12. Correspond√™ncia das a√ß√µes -->
                    <div class="form-group">
                        <label>2.12. As a√ß√µes efetivamente executadas correspondem √† oferta para a qual possui inscri√ß√£o?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="acoes_correspondem" value="sim"> sim</label>
                            <label><input type="radio" name="acoes_correspondem" value="nao"> n√£o</label>
                        </div>
                        <div class="form-group">
                            <label for="obs_acoes_correspondem">Observa√ß√µes:</label>
                            <textarea id="obs_acoes_correspondem" name="obs_acoes_correspondem" rows="8"></textarea>
                        </div>
                    </div>

                    <!-- 2.13. Articula√ß√£o com a rede -->
                    <div class="form-group">
                        <label>2.13. Articula√ß√£o com a rede setorial SUAS e outras redes:</label>
                        
                        <div style="margin: 20px 0;">
                            <div class="articulacao-grid articulacao-header">
                                <div>Tipo de Rede</div>
                                <div>Sim</div>
                                <div>N√£o</div>
                                <div>Observa√ß√µes</div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>CRAS</div>
                                <div><input type="radio" name="articulacao_cras" value="sim"></div>
                                <div><input type="radio" name="articulacao_cras" value="nao"></div>
                                <div><input type="text" name="obs_cras" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>CREAS</div>
                                <div><input type="radio" name="articulacao_creas" value="sim"></div>
                                <div><input type="radio" name="articulacao_creas" value="nao"></div>
                                <div><input type="text" name="obs_creas" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>Sa√∫de</div>
                                <div><input type="radio" name="articulacao_saude" value="sim"></div>
                                <div><input type="radio" name="articulacao_saude" value="nao"></div>
                                <div><input type="text" name="obs_saude" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>Educa√ß√£o</div>
                                <div><input type="radio" name="articulacao_educacao" value="sim"></div>
                                <div><input type="radio" name="articulacao_educacao" value="nao"></div>
                                <div><input type="text" name="obs_educacao" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>Habita√ß√£o</div>
                                <div><input type="radio" name="articulacao_habitacao" value="sim"></div>
                                <div><input type="radio" name="articulacao_habitacao" value="nao"></div>
                                <div><input type="text" name="obs_habitacao" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>Trabalho e Renda</div>
                                <div><input type="radio" name="articulacao_trabalho" value="sim"></div>
                                <div><input type="radio" name="articulacao_trabalho" value="nao"></div>
                                <div><input type="text" name="obs_trabalho" placeholder="Observa√ß√µes"></div>
                            </div>
                            
                            <div class="articulacao-grid">
                                <div>Sistema de Justi√ßa</div>
                                <div><input type="radio" name="articulacao_justica" value="sim"></div>
                                <div><input type="radio" name="articulacao_justica" value="nao"></div>
                                <div><input type="text" name="obs_justica" placeholder="Observa√ß√µes"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 2.14. Metodologia -->
                    <div class="form-group">
                        <label>2.14. A forma de execu√ß√£o (metodologia) das a√ß√µes atende √†s diretrizes das regulamenta√ß√µes?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="metodologia_adequada" value="sim"> sim</label>
                            <label><input type="radio" name="metodologia_adequada" value="nao"> n√£o</label>
                        </div>
                        <div class="form-group">
                            <label for="obs_metodologia">Observa√ß√µes:</label>
                            <textarea id="obs_metodologia" name="obs_metodologia" rows="4"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-section" style="border: 2px solid #4caf50; background: #f8fff8;">
                    <h3>üì∏ 2.15. DOCUMENTA√á√ÉO FOTOGR√ÅFICA</h3>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="margin: 0; font-size: 14px; color: #2e7d32;">
                            <strong>üí° Nova Funcionalidade:</strong> Adicione fotos para complementar sua fiscaliza√ß√£o. 
                            As imagens ser√£o inclu√≠das no relat√≥rio final.
                        </p>
                    </div>

                    <!-- Controles de Fotos -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button type="button" onclick="abrirCameraFiscalizacao()" class="btn btn-primary" style="background: #4caf50;">
                            üì∑ Tirar Foto
                        </button>
                        <button type="button" onclick="selecionarFotosFiscalizacao()" class="btn btn-secondary">
                            üìÅ Selecionar Fotos
                        </button>
                        <button type="button" onclick="limparTodasFotos()" class="btn btn-danger" style="font-size: 14px;">
                            üóëÔ∏è Limpar Todas
                        </button>
                        <span id="contador-fotos" style="align-self: center; font-weight: bold; color: #4caf50;">
                            üìä 0 fotos adicionadas
                        </span>
                    </div>

                    <!-- Container de Fotos Organizadas -->
                    <div id="fotos-fiscalizacao-container">
                        
                        <!-- Categoria: Fachada/Externa -->
                        <div class="categoria-fotos" data-categoria="fachada">
                            <h4 style="color: #2e7d32; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">
                                üè¢ Fachada/√Årea Externa
                            </h4>
                            <div class="fotos-grid" id="fotos-fachada"></div>
                            <button type="button" onclick="adicionarFotoCategoria('fachada')" class="btn-mini">+ Adicionar</button>
                        </div>

                        <!-- Categoria: Internas -->
                        <div class="categoria-fotos" data-categoria="internas">
                            <h4 style="color: #2e7d32; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">
                                üè† Depend√™ncias Internas
                            </h4>
                            <div class="fotos-grid" id="fotos-internas"></div>
                            <button type="button" onclick="adicionarFotoCategoria('internas')" class="btn-mini">+ Adicionar</button>
                        </div>

                        <!-- Categoria: Documentos -->
                        <div class="categoria-fotos" data-categoria="documentos">
                            <h4 style="color: #2e7d32; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">
                                üìã Documentos/Licen√ßas
                            </h4>
                            <div class="fotos-grid" id="fotos-documentos"></div>
                            <button type="button" onclick="adicionarFotoCategoria('documentos')" class="btn-mini">+ Adicionar</button>
                        </div>

                        <!-- Categoria: Acessibilidade -->
                        <div class="categoria-fotos" data-categoria="acessibilidade">
                            <h4 style="color: #2e7d32; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">
                                ‚ôø Acessibilidade
                            </h4>
                            <div class="fotos-grid" id="fotos-acessibilidade"></div>
                            <button type="button" onclick="adicionarFotoCategoria('acessibilidade')" class="btn-mini">+ Adicionar</button>
                        </div>

                        <!-- Categoria: Observa√ß√µes Gerais -->
                        <div class="categoria-fotos" data-categoria="observacoes">
                            <h4 style="color: #2e7d32; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">
                                üëÅÔ∏è Observa√ß√µes Gerais
                            </h4>
                            <div class="fotos-grid" id="fotos-observacoes"></div>
                            <button type="button" onclick="adicionarFotoCategoria('observacoes')" class="btn-mini">+ Adicionar</button>
                        </div>

                    </div>

                    <!-- Input hidden para captura de fotos -->
                    <input type="file" id="foto-input-hidden" accept="image/*" capture="environment" multiple style="display: none;">
                    
                    <!-- Modal para descri√ß√£o da foto -->
                    <div id="modal-descricao-foto" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 500px;">
                            <h4>üìù Descri√ß√£o da Foto</h4>
                            <div style="text-align: center; margin: 15px 0;">
                                <img id="preview-foto-descricao" style="max-width: 100%; max-height: 200px; border: 1px solid #ccc;">
                            </div>
                            <div class="form-group">
                                <label for="descricao-foto-input">Descri√ß√£o (opcional):</label>
                                <input type="text" id="descricao-foto-input" placeholder="Ex: Entrada principal, Licen√ßa de funcionamento, etc." style="width: 100%;">
                            </div>
                            <div class="form-group">
                                <label for="categoria-foto-select">Categoria:</label>
                                <select id="categoria-foto-select" style="width: 100%;">
                                    <option value="fachada">üè¢ Fachada/√Årea Externa</option>
                                    <option value="internas">üè† Depend√™ncias Internas</option>
                                    <option value="documentos">üìã Documentos/Licen√ßas</option>
                                    <option value="acessibilidade">‚ôø Acessibilidade</option>
                                    <option value="observacoes">üëÅÔ∏è Observa√ß√µes Gerais</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                <button onclick="salvarFotoComDescricao()" class="btn btn-success">‚úÖ Salvar</button>
                                <button onclick="cancelarDescricaoFoto()" class="btn btn-secondary">‚ùå Cancelar</button>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 3. DO VOTO -->
                <div class="form-section">
                    <h3>‚öñÔ∏è 3. DO VOTO</h3>
                    
                    <div class="form-group">
                        <label>3.1. Quanto √†s an√°lises t√©cnicas elaboradas pela Secretaria Executiva, o Relator:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="concordancia_analises" value="concorda"> concorda</label>
                            <label><input type="radio" name="concordancia_analises" value="discorda"> discorda</label>
                        </div>
                        <div class="form-group">
                            <label for="fundamentos_discordancia">Fundamentos (se discorda):</label>
                            <textarea id="fundamentos_discordancia" name="fundamentos_discordancia" rows="4"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>3.2. O(A) Conselheiro(a) vota pelo(a):</label>
                        <div style="margin: 15px 0;">
                            <div style="margin-bottom: 10px;">
                                <label><input type="radio" name="voto_final" value="Indeferimento do pedido quanto √† oferta analisada"> Indeferimento do pedido quanto √† oferta analisada</label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label><input type="radio" name="voto_final" value="Deferimento do pedido quanto √† oferta analisada"> Deferimento do pedido quanto √† oferta analisada</label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label><input type="radio" name="voto_final" value="Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada"> Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada</label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label><input type="radio" name="voto_final" value="Cancelamento da inscri√ß√£o quanto √† oferta analisada"> Cancelamento da inscri√ß√£o quanto √† oferta analisada</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="data_voto">Data do voto:</label>
                            <input type="date" id="data_voto" name="data_voto">
                        </div>
                        <div class="form-group">
                            <label for="nome_conselheiro">Conselheiro(a):</label>
                            <input type="text" id="nome_conselheiro" name="nome_conselheiro" required>
                        </div>
                    </div>
                </div>

                <!-- 4. DECLARA√á√ÉO DE RESPONSABILIDADE -->
                <div class="form-section" style="border: 3px solid #f56565; background: #fef5e7;">
                    <h3 style="color: #c53030;">üîí 4. DECLARA√á√ÉO DE RESPONSABILIDADE</h3>
                    
                    <div class="form-group" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="border: 2px solid #e2e8f0; padding: 20px; border-radius: 8px; background: #f7fafc;">
                            <p style="font-size: 14px; line-height: 1.6; margin-bottom: 15px; text-align: justify;">
                                <strong>DECLARA√á√ÉO:</strong> Eu, abaixo assinado(a), na qualidade de Conselheiro(a) do Conselho de Assist√™ncia Social do Distrito Federal (CAS-DF), declaro para os devidos fins que:
                            </p>
                            <ul style="font-size: 14px; line-height: 1.6; margin: 15px 0; padding-left: 30px;">
                                <li>Todas as informa√ß√µes prestadas neste relat√≥rio de fiscaliza√ß√£o s√£o <strong>verdadeiras e fidedignas</strong>;</li>
                                <li>A visita de fiscaliza√ß√£o foi realizada de acordo com as <strong>normas e procedimentos</strong> estabelecidos pelo CAS-DF;</li>
                                <li>As observa√ß√µes e avalia√ß√µes constantes neste documento refletem a <strong>realidade observada in loco</strong>;</li>
                                <li>Estou ciente das <strong>responsabilidades legais</strong> decorrentes desta declara√ß√£o;</li>
                                <li>O presente relat√≥rio foi elaborado com <strong>imparcialidade e independ√™ncia</strong>, sem conflito de interesses.</li>
                            </ul>
                            <p style="font-size: 14px; line-height: 1.6; margin-top: 15px; text-align: justify;">
                                Declaro ainda estar ciente de que as informa√ß√µes aqui prestadas est√£o sujeitas √†s penalidades previstas no Art. 299 do C√≥digo Penal (falsidade ideol√≥gica), caso sejam inver√≠dicas.
                            </p>
                        </div>
                        
                        <div style="margin: 20px 0; padding: 15px; background: #e6fffa; border-left: 4px solid #38a169; border-radius: 5px;">
                            <label style="display: flex; align-items: center; font-weight: 600; color: #2d3748;">
                                <input type="checkbox" id="declaracao_veracidade" name="declaracao_veracidade" required style="margin-right: 15px; transform: scale(1.5);">
                                <span>CONFIRMO que li, compreendi e concordo integralmente com a declara√ß√£o acima, assumindo total responsabilidade pelas informa√ß√µes prestadas neste relat√≥rio de fiscaliza√ß√£o.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Assinatura Digital Aprimorada -->
                    <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #4299e1;">
                        <h4 style="color: #2b6cb0; margin-bottom: 20px;">üîê ASSINATURA DIGITAL OFICIAL</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cpf_conselheiro">CPF do Conselheiro (somente n√∫meros):</label>
                                <input type="text" id="cpf_conselheiro" name="cpf_conselheiro" placeholder="000.000.000-00" maxlength="14" required>
                            </div>
                            <div class="form-group">
                                <label for="senha_assinatura">Senha de Confirma√ß√£o:</label>
                                <input type="password" id="senha_assinatura" name="senha_assinatura" placeholder="Digite sua senha pessoal" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: flex; align-items: center; margin: 15px 0;">
                                <input type="checkbox" id="confirma_assinatura" name="confirma_assinatura" required style="margin-right: 10px; transform: scale(1.3);">
                                <span style="font-weight: 600;">Confirmo minha identidade e autorizo a assinatura digital deste documento</span>
                            </label>
                        </div>
                        
                        <button type="button" onclick="assinarDigitalmente()" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 16px; margin-top: 10px;">
                            üîí ASSINAR DOCUMENTO DIGITALMENTE
                        </button>
                        
                        <div id="signatureInfo" style="display: none; margin-top: 20px; padding: 20px; background: #f0fff4; border: 2px solid #48bb78; border-radius: 10px;">
                            <h5 style="color: #38a169; margin-bottom: 15px;">‚úÖ DOCUMENTO ASSINADO DIGITALMENTE</h5>
                            <div style="font-size: 14px; line-height: 1.6;">
                                <p><strong>Conselheiro:</strong> <span id="signatoryName"></span></p>
                                <p><strong>CPF:</strong> <span id="signatoryCPF"></span></p>
                                <p><strong>Data/Hora:</strong> <span id="signatureDateTime"></span></p>
                                <p><strong>Hash de Verifica√ß√£o:</strong> <span id="verificationHash" style="font-family: monospace; background: #e2e8f0; padding: 5px;"></span></p>
                                <p><strong>Status:</strong> <span style="color: #38a169; font-weight: bold;">V√ÅLIDA</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bot√µes de A√ß√£o -->
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="salvarRascunho()">üíæ Salvar Rascunho</button>
                    <button type="button" class="btn btn-secondary" onclick="carregarRascunho()">üìÇ Carregar Rascunho</button>
                    <button type="button" class="btn btn-secondary" onclick="validarFormulario()">‚úÖ Validar</button>
                    <button type="button" class="btn btn-primary" onclick="gerarRelatorio()" id="btnRelatorio" disabled>üìÑ Gerar Relat√≥rio</button>
                    <button type="button" class="btn btn-primary" onclick="exportarHTML()">üì• Exportar HTML</button>
                    <button type="button" class="btn btn-danger" onclick="limparFormulario()">üóëÔ∏è Limpar Tudo</button>
                </div>
            </form>

            <!-- Se√ß√£o do Relat√≥rio -->
            <div id="reportSection" style="display: none; margin-top: 40px; padding: 30px; background: #f7fafc; border-radius: 15px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>üìã FICHA DE RELATO DE FISCALIZA√á√ÉO</h2>
                    <p><strong>CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL</strong></p>
                    <p>SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF - CEP 70.770-502</p>
                    <p>E-mail: Cas_df@sedes.df.gov.br</p>
                </div>
                
                <div id="reportContent"></div>

                <div class="action-buttons" style="margin-top: 30px;">
                    <button onclick="voltarFormulario()" class="btn btn-secondary">‚¨ÖÔ∏è Voltar</button>
                    <button onclick="gerarPDFParaEmail()" class="btn btn-primary">üìÑ Baixar PDF</button>
                    <button onclick="enviarEmailDireto()" class="btn btn-success">üìß Enviar para CAS-DF</button>
                    <button onclick="enviarEmail()" class="btn btn-success">üìß Email Personalizado</button>
                    <button onclick="enviarPorWhatsApp()" class="btn btn-success">üì± WhatsApp</button>
                    <button onclick="verificarDocumento()" class="btn btn-secondary">üîç Verificar Hash</button>
                    <button onclick="salvarRelatorio()" class="btn btn-secondary">üíæ Backup HTML</button>
                </div>

                <!-- Modal de Email -->
                <div id="emailModal" class="modal">
                    <div class="modal-content" style="max-width: 700px;">
                        <span class="close" onclick="fecharEmailModal()">&times;</span>
                        <h3>üìß Enviar Relat√≥rio para o CAS-DF</h3>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3;">
                            <h4 style="margin: 0 0 10px 0; color: #1976d2;">‚ÑπÔ∏è Instru√ß√µes para Envio</h4>
                            <ol style="margin: 0; padding-left: 20px; font-size: 14px;">
                                <li>Clique em "üìß Abrir no Email" para abrir seu cliente de email</li>
                                <li>O email ser√° pr√©-preenchido com os dados do relat√≥rio</li>
                                <li><strong>IMPORTANTE:</strong> Anexe manualmente o arquivo PDF antes de enviar</li>
                                <li>Use "üìÑ Baixar PDF" se ainda n√£o baixou o arquivo</li>
                            </ol>
                        </div>
                        
                        <div class="form-group">
                            <label for="email_destinatario">Para (destinat√°rio):</label>
                            <input type="email" id="email_destinatario" value="Cas_df@sedes.df.gov.br" style="width: 100%;" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="email_copia">Com c√≥pia (CC) - Opcional:</label>
                            <input type="email" id="email_copia" placeholder="seu.email@exemplo.com" style="width: 100%;">
                        </div>
                        
                        <div class="form-group">
                            <label for="email_assunto">Assunto:</label>
                            <input type="text" id="email_assunto" style="width: 100%;" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="email_corpo">Mensagem:</label>
                            <textarea id="email_corpo" rows="12" style="width: 100%;" readonly></textarea>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 5px; border-left: 4px solid #ff9800;">
                            <p style="margin: 0; font-size: 14px;"><strong>üìé Anexo Obrigat√≥rio:</strong></p>
                            <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">Arquivo: <span id="nome_arquivo_email"></span></p>
                            <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;"><strong>‚ö†Ô∏è Lembre-se de anexar o PDF antes de enviar o email!</strong></p>
                        </div>
                        
                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                            <button onclick="gerarPDFParaEmail()" class="btn btn-primary">üìÑ Baixar PDF</button>
                            <button onclick="abrirClienteEmail()" class="btn btn-success">üìß Abrir no Email</button>
                            <button onclick="copiarTextoEmail()" class="btn btn-secondary">üìã Copiar Texto</button>
                            <button onclick="fecharEmailModal()" class="btn btn-secondary">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Modal de Verifica√ß√£o -->
                <div id="verificacaoModal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="fecharVerificacaoModal()">&times;</span>
                        <h3>üîç Verifica√ß√£o de Autenticidade</h3>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div id="qrcode" style="display: inline-block; padding: 20px; background: white; border: 2px solid #e2e8f0; border-radius: 10px;"></div>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">üìã Dados de Verifica√ß√£o:</h4>
                            <p><strong>N√∫mero do Documento:</strong> <span id="numero_documento_verify"></span></p>
                            <p><strong>Hash de Verifica√ß√£o:</strong> <br><code id="hash_documento_verify" style="background: #e2e8f0; padding: 5px; font-family: monospace; word-break: break-all;"></code></p>
                            <p><strong>Data/Hora de Assinatura:</strong> <span id="timestamp_verify"></span></p>
                            <p><strong>Conselheiro:</strong> <span id="conselheiro_verify"></span></p>
                            <p><strong>CPF:</strong> <span id="cpf_verify"></span></p>
                        </div>
                        
                        <div style="background: #f0fff4; border: 2px solid #48bb78; padding: 15px; border-radius: 10px; text-align: center;">
                            <h4 style="color: #38a169; margin: 0;">‚úÖ DOCUMENTO AUT√äNTICO</h4>
                            <p style="margin: 5px 0 0 0; font-size: 14px;">Este documento possui assinatura digital v√°lida</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="fecharVerificacaoModal()" class="btn btn-primary">‚úÖ OK</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- √Årea de Notifica√ß√µes -->
    <div id="notification" class="notification"></div>

    <script>
        // Vari√°veis globais
        let assinaturaValida = false;
        let hashDocumento = '';
        let numeroDocumento = '';
        let dadosRelatorio = {};

        // Inicializa√ß√£o segura
        function inicializar() {
            try {
                const hoje = new Date().toISOString().split('T')[0];
                const dataVisitaEl = document.getElementById('data_visita');
                const dataVotoEl = document.getElementById('data_voto');
                
                if (dataVisitaEl) dataVisitaEl.value = hoje;
                if (dataVotoEl) dataVotoEl.value = hoje;
                
                aplicarMascaras();
                monitorarValidacoes();
                gerarNumeroDocumento();
                
                mostrarNotificacao('Sistema carregado com sucesso!', 'success', 2000);
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                mostrarNotificacao('Erro ao carregar sistema. Recarregue a p√°gina.', 'error');
            }
        }

        // Aguardar DOM carregar
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializar);
        } else {
            inicializar();
        }

        // Gerar n√∫mero sequencial do documento
        function gerarNumeroDocumento() {
            try {
                const ano = new Date().getFullYear();
                const contador = localStorage.getItem('cas_contador_documentos') || '0';
                const novoContador = String(parseInt(contador) + 1).padStart(4, '0');
                numeroDocumento = `CAS-DF-${ano}-${novoContador}`;
                localStorage.setItem('cas_contador_documentos', novoContador);
            } catch (error) {
                console.error('Erro ao gerar n√∫mero do documento:', error);
                numeroDocumento = `CAS-DF-${new Date().getFullYear()}-${Date.now()}`;
            }
        }

        // Aplicar m√°scaras com verifica√ß√£o segura
        function aplicarMascaras() {
            try {
                const cpfInput = document.getElementById('cpf_conselheiro');
                if (cpfInput) {
                    cpfInput.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/\D/g, '');
                        value = value.replace(/(\d{3})(\d)/, '$1.$2');
                        value = value.replace(/(\d{3})(\d)/, '$1.$2');
                        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                        e.target.value = value;
                    });
                }

                // NOVA M√ÅSCARA PARA CNPJ
                const cnpjInput = document.getElementById('cnpj_entidade');
                if (cnpjInput) {
                    cnpjInput.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/\D/g, '');
                        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                        value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                        value = value.replace(/(\d{4})(\d)/, '$1-$2');
                        e.target.value = value;
                    });
                }
            } catch (error) {
                console.error('Erro ao aplicar m√°scaras:', error);
            }
        }

        // Monitorar valida√ß√µes para habilitar/desabilitar bot√£o de relat√≥rio
        function monitorarValidacoes() {
            try {
                const btnRelatorio = document.getElementById('btnRelatorio');
                const checkDeclaracao = document.getElementById('declaracao_veracidade');
                
                if (checkDeclaracao) {
                    checkDeclaracao.addEventListener('change', verificarLiberacaoRelatorio);
                }

                // Verificar periodicamente se pode liberar o relat√≥rio
                setInterval(verificarLiberacaoRelatorio, 1000);
            } catch (error) {
                console.error('Erro ao monitorar valida√ß√µes:', error);
            }
        }

        // Verificar se pode liberar gera√ß√£o de relat√≥rio
        function verificarLiberacaoRelatorio() {
            try {
                const btnRelatorio = document.getElementById('btnRelatorio');
                const checkDeclaracao = document.getElementById('declaracao_veracidade');
                
                if (!btnRelatorio || !checkDeclaracao) return;
                
                const declaracaoMarcada = checkDeclaracao.checked;
                
                if (declaracaoMarcada && assinaturaValida) {
                    btnRelatorio.disabled = false;
                    btnRelatorio.style.opacity = '1';
                    btnRelatorio.title = 'Clique para gerar o relat√≥rio';
                } else {
                    btnRelatorio.disabled = true;
                    btnRelatorio.style.opacity = '0.5';
                    if (!declaracaoMarcada) {
                        btnRelatorio.title = 'Marque a declara√ß√£o de responsabilidade';
                    } else if (!assinaturaValida) {
                        btnRelatorio.title = 'Assine digitalmente o documento';
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar libera√ß√£o do relat√≥rio:', error);
            }
        }

        // Validar CPF (algoritmo oficial)
        function validarCPF(cpf) {
            try {
                cpf = cpf.replace(/\D/g, '');
                if (cpf.length !== 11) return false;
                if (/^(\d)\1+$/.test(cpf)) return false;
                
                let soma = 0;
                for (let i = 0; i < 9; i++) {
                    soma += parseInt(cpf.charAt(i)) * (10 - i);
                }
                let resto = 11 - (soma % 11);
                let dv1 = resto < 2 ? 0 : resto;
                
                if (parseInt(cpf.charAt(9)) !== dv1) return false;
                
                soma = 0;
                for (let i = 0; i < 10; i++) {
                    soma += parseInt(cpf.charAt(i)) * (11 - i);
                }
                resto = 11 - (soma % 11);
                let dv2 = resto < 2 ? 0 : resto;
                
                return parseInt(cpf.charAt(10)) === dv2;
            } catch (error) {
                console.error('Erro ao validar CPF:', error);
                return false;
            }
        }

        // NOVA FUN√á√ÉO: Validar CNPJ
        function validarCNPJ(cnpj) {
            try {
                cnpj = cnpj.replace(/\D/g, '');
                if (cnpj.length !== 14) return false;
                if (/^(\d)\1+$/.test(cnpj)) return false;
                
                // Valida√ß√£o do primeiro d√≠gito
                let soma = 0;
                let peso = 2;
                for (let i = 11; i >= 0; i--) {
                    soma += parseInt(cnpj.charAt(i)) * peso;
                    peso = peso === 9 ? 2 : peso + 1;
                }
                let dv1 = soma % 11 < 2 ? 0 : 11 - (soma % 11);
                
                if (parseInt(cnpj.charAt(12)) !== dv1) return false;
                
                // Valida√ß√£o do segundo d√≠gito
                soma = 0;
                peso = 2;
                for (let i = 12; i >= 0; i--) {
                    soma += parseInt(cnpj.charAt(i)) * peso;
                    peso = peso === 9 ? 2 : peso + 1;
                }
                let dv2 = soma % 11 < 2 ? 0 : 11 - (soma % 11);
                
                return parseInt(cnpj.charAt(13)) === dv2;
            } catch (error) {
                console.error('Erro ao validar CNPJ:', error);
                return false;
            }
        }

        // Gerar hash robusto do documento
        function gerarHashDocumento() {
            try {
                const form = document.getElementById('fiscalizacaoForm');
                if (!form) throw new Error('Formul√°rio n√£o encontrado');
                
                const formData = new FormData(form);
                const dados = Object.fromEntries(formData.entries());
                
                // Adicionar dados dos checkboxes
                const servicosSelecionados = Array.from(document.querySelectorAll('input[name="tipoServico"]:checked'))
                    .map(cb => cb.value);
                const formasAcesso = Array.from(document.querySelectorAll('input[name="formasAcesso"]:checked'))
                    .map(cb => cb.value);
                const especialidades = Array.from(document.querySelectorAll('input[name="especialidades"]:checked'))
                    .map(cb => cb.value);
                
                // Criar string de dados para hash
                const dadosString = JSON.stringify({
                    numeroDocumento,
                    ...dados,
                    tipoServico: servicosSelecionados,
                    formasAcesso: formasAcesso,
                    especialidades: especialidades,
                    timestamp: new Date().toISOString()
                });
                
                // Gerar hash usando btoa e manipula√ß√£o de string
                let hash = '';
                for (let i = 0; i < dadosString.length; i++) {
                    hash += dadosString.charCodeAt(i).toString(16);
                }
                
                // Reduzir e formatar hash
                return btoa(hash).substring(0, 32).toUpperCase();
            } catch (error) {
                console.error('Erro ao gerar hash:', error);
                return 'HASH_ERROR_' + Date.now();
            }
        }

        // Assinatura digital aprimorada
        function assinarDigitalmente() {
            try {
                const cpf = document.getElementById('cpf_conselheiro')?.value;
                const cnpj = document.getElementById('cnpj_entidade')?.value;
                const senha = document.getElementById('senha_assinatura')?.value;
                const conselheiro = document.getElementById('nome_conselheiro')?.value;
                const entidade = document.getElementById('nome_entidade')?.value;
                const confirmaAssinatura = document.getElementById('confirma_assinatura')?.checked;
                
                // Valida√ß√µes ATUALIZADAS
                if (!cpf || !cnpj || !senha || !conselheiro || !entidade) {
                    mostrarNotificacao('Preencha todos os campos obrigat√≥rios (incluindo nome da entidade e CNPJ)', 'error');
                    return;
                }
                
                if (!validarCPF(cpf)) {
                    mostrarNotificacao('CPF inv√°lido. Verifique os n√∫meros digitados.', 'error');
                    return;
                }

                // NOVA VALIDA√á√ÉO: CNPJ
                if (!validarCNPJ(cnpj)) {
                    mostrarNotificacao('CNPJ inv√°lido. Verifique os n√∫meros digitados.', 'error');
                    return;
                }
                
                if (senha.length < 6) {
                    mostrarNotificacao('Senha deve ter pelo menos 6 caracteres', 'error');
                    return;
                }
                
                if (!confirmaAssinatura) {
                    mostrarNotificacao('Confirme a autoriza√ß√£o de assinatura digital', 'error');
                    return;
                }

                // Gerar assinatura digital
                const timestamp = new Date();
                const timestampFormatado = timestamp.toLocaleString('pt-BR', { 
                    timeZone: 'America/Sao_Paulo',
                    day: '2-digit',
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                hashDocumento = gerarHashDocumento();
                
                // Salvar dados do relat√≥rio ATUALIZADO
                dadosRelatorio = {
                    numeroDocumento,
                    conselheiro,
                    cpf,
                    entidade,
                    cnpj,
                    timestamp: timestampFormatado,
                    hash: hashDocumento
                };
                
                // Exibir informa√ß√µes da assinatura
                const elements = {
                    signatoryName: document.getElementById('signatoryName'),
                    signatoryCPF: document.getElementById('signatoryCPF'),
                    signatureDateTime: document.getElementById('signatureDateTime'),
                    verificationHash: document.getElementById('verificationHash'),
                    signatureInfo: document.getElementById('signatureInfo')
                };
                
                if (elements.signatoryName) elements.signatoryName.textContent = conselheiro;
                if (elements.signatoryCPF) elements.signatoryCPF.textContent = cpf;
                if (elements.signatureDateTime) elements.signatureDateTime.textContent = timestampFormatado + ' (Bras√≠lia)';
                if (elements.verificationHash) elements.verificationHash.textContent = hashDocumento;
                if (elements.signatureInfo) elements.signatureInfo.style.display = 'block';
                
                // Limpar campos sens√≠veis
                const senhaEl = document.getElementById('senha_assinatura');
                if (senhaEl) senhaEl.value = '';
                
                // Marcar como v√°lida
                assinaturaValida = true;
                
                // Desabilitar campos de assinatura ATUALIZADO
                const cpfEl = document.getElementById('cpf_conselheiro');
                const cnpjEl = document.getElementById('cnpj_entidade');
                const confirmaEl = document.getElementById('confirma_assinatura');
                if (cpfEl) cpfEl.setAttribute('readonly', true);
                if (cnpjEl) cnpjEl.setAttribute('readonly', true);
                if (confirmaEl) confirmaEl.disabled = true;
                
                verificarLiberacaoRelatorio();
                
                mostrarNotificacao('Documento assinado digitalmente com sucesso!', 'success');
            } catch (error) {
                console.error('Erro na assinatura digital:', error);
                mostrarNotificacao('Erro ao assinar documento. Tente novamente.', 'error');
            }
        }

        // Validar formul√°rio ATUALIZADO
        function validarFormulario() {
            try {
                const camposObrigatorios = [
                    'nome_entidade', 'cnpj_entidade', 'data_visita',
                    'nome_recebeu', 'funcao_recebeu', 'nome_conselheiro'
                ];

                let erros = [];

                // Validar campos b√°sicos
                camposObrigatorios.forEach(campo => {
                    const elemento = document.getElementById(campo);
                    if (!elemento || !elemento.value.trim()) {
                        const label = elemento?.parentElement?.querySelector('label')?.textContent || campo;
                        erros.push(`Campo "${label}" √© obrigat√≥rio`);
                    }
                });

                // NOVA VALIDA√á√ÉO: Verificar CNPJ
                const cnpj = document.getElementById('cnpj_entidade')?.value;
                if (cnpj && !validarCNPJ(cnpj)) {
                    erros.push('CNPJ inv√°lido');
                }

                // Verificar servi√ßos selecionados
                const servicosSelecionados = document.querySelectorAll('input[name="tipoServico"]:checked');
                if (servicosSelecionados.length === 0) {
                    erros.push('Selecione pelo menos um tipo de servi√ßo');
                }

                // Verificar hor√°rio da visita
                const horarioSelecionado = document.querySelector('input[name="horario_visita"]:checked');
                if (!horarioSelecionado) {
                    erros.push('Selecione o hor√°rio da visita');
                }

                // Verificar declara√ß√£o de responsabilidade
                const declaracaoMarcada = document.getElementById('declaracao_veracidade')?.checked;
                if (!declaracaoMarcada) {
                    erros.push('Marque a declara√ß√£o de responsabilidade');
                }

                // Verificar assinatura digital
                if (!assinaturaValida) {
                    erros.push('Assine digitalmente o documento');
                }

                if (erros.length > 0) {
                    mostrarNotificacao(`Erros encontrados:\n${erros.join('\n')}`, 'error');
                    return false;
                }

                mostrarNotificacao('Formul√°rio v√°lido e pronto para gerar relat√≥rio! ‚úÖ', 'success');
                return true;
            } catch (error) {
                console.error('Erro na valida√ß√£o:', error);
                mostrarNotificacao('Erro ao validar formul√°rio.', 'error');
                return false;
            }
        }

        // Gerar relat√≥rio ATUALIZADO
        function gerarRelatorio() {
            try {
                if (!validarFormulario()) return;

                const form = document.getElementById('fiscalizacaoForm');
                if (!form) throw new Error('Formul√°rio n√£o encontrado');

                const formData = new FormData(form);
                const dados = Object.fromEntries(formData.entries());

                // Obter dados dos checkboxes
                const servicosSelecionados = Array.from(document.querySelectorAll('input[name="tipoServico"]:checked'))
                    .map(cb => cb.value);
                const formasAcesso = Array.from(document.querySelectorAll('input[name="formasAcesso"]:checked'))
                    .map(cb => cb.value);
                const especialidades = Array.from(document.querySelectorAll('input[name="especialidades"]:checked'))
                    .map(cb => cb.value);

                let relatorio = `
                    <div style="page-break-after: always;">
                        <p style="text-align: center; margin-bottom: 30px;"><strong>Seja o presente voto submetido √† delibera√ß√£o da plen√°ria.</strong></p>
                        
                        <h3>ESTE VOTO ANALISAR√Å O SEGUINTE SERVI√áO:</h3>
                        <ul>
                            ${servicosSelecionados.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                        
                        <h3>1. DOCUMENTOS DISPONIBILIZADOS:</h3>
                        <p><strong>Parecer(s) T√©cnico(s) n¬∫:</strong> ${dados.pareceres_tecnicos || '_'.repeat(50)}</p>
                        <p><strong>Nota(s) T√©cnica(s) n¬∫:</strong> ${dados.notas_tecnicas || '_'.repeat(50)}</p>
                        <p><strong>Plano de A√ß√£o Ano:</strong> ${dados.plano_acao_ano || '____'} &nbsp;&nbsp;&nbsp; <strong>Relat√≥rio de Atividades Ano:</strong> ${dados.relatorio_atividades_ano || '____'}</p>
                        
                        <h3>2. DA VISITA</h3>
                        <p><strong>Nome da Entidade Visitada:</strong> ${dados.nome_entidade || '____'}</p>
                        <p><strong>CNPJ:</strong> ${dados.cnpj_entidade || '____'}</p>
                        <p><strong>2.1. Data:</strong> ${dados.data_visita ? new Date(dados.data_visita).toLocaleDateString('pt-BR') : '____'}</p>
                        <p><strong>2.2. Hor√°rio:</strong> ${dados.horario_visita === 'matutino' ? '‚òë matutino ‚òê vespertino' : '‚òê matutino ‚òë vespertino'}</p>
                        <p><strong>2.3. Nome de quem recebeu o conselheiro na institui√ß√£o:</strong> ${dados.nome_recebeu || '____'}<br>
                        <strong>Fun√ß√£o:</strong> ${dados.funcao_recebeu || '____'}</p>
                        
                        <h4>2.4. Endere√ßo(s) visitado(s):</h4>
                        ${dados.endereco_1 ? `<p><strong>1:</strong> ${dados.endereco_1} - Licen√ßa de Funcionamento: ${dados.licenca_1 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        ${dados.endereco_2 ? `<p><strong>2:</strong> ${dados.endereco_2} - Licen√ßa de Funcionamento: ${dados.licenca_2 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        ${dados.endereco_3 ? `<p><strong>3:</strong> ${dados.endereco_3} - Licen√ßa de Funcionamento: ${dados.licenca_3 === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>` : ''}
                        
                        <h4>2.5. P√∫blico-alvo:</h4>
                        <table border="1" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <tr><th>P√∫blico</th><th>CDI/DF</th><th>CDCA/DF</th></tr>
                            <tr><td>Pessoas idosas (mais de 60 anos)</td><td>${dados.cdi_idosos === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td><td>n√£o se aplica</td></tr>
                            <tr><td>Crian√ßas e adolescentes (at√© 18 anos)</td><td>n√£o se aplica</td><td>${dados.cdca_criancas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td></tr>
                            <tr><td>Fam√≠lias</td><td>${dados.cdi_familias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td><td>${dados.cdca_familias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</td></tr>
                            <tr><td>Adultos (entre 18 a 59 anos)</td><td>n√£o se aplica</td><td>n√£o se aplica</td></tr>
                        </table>
                        
                        <h4>2.6. Formas de acesso dos usu√°rios nos servi√ßos/a√ß√µes:</h4>
                        <ul>
                            ${formasAcesso.map(forma => `<li>‚òë ${forma}</li>`).join('')}
                            ${dados.outras_formas ? `<li>‚òë Outros: ${dados.outras_formas}</li>` : ''}
                        </ul>
                        
                        <h4>2.7. Equipe de profissionais:</h4>
                        <p><strong>N¬∫ de volunt√°rios:</strong> ${dados.num_voluntarios || '____'} &nbsp;&nbsp;&nbsp; <strong>N¬∫ de contratados:</strong> ${dados.num_contratados || '____'}</p>
                        
                        <h4>2.8. Especialidades que atuam na oferta socioassistencial:</h4>
                        <ul>
                            ${especialidades.map(esp => `<li>‚òë ${esp}</li>`).join('')}
                            ${dados.outras_especialidades ? `<li>‚òë outros: ${dados.outras_especialidades}</li>` : ''}
                        </ul>
                        
                        <h4>2.9. Infraestrutura:</h4>
                        <p><strong>a) O Espa√ßo √©:</strong> ${dados.tipo_espaco === 'pr√≥prio' ? '‚òë pr√≥prio' : '‚òê pr√≥prio'} ${dados.tipo_espaco === 'alugado' ? '‚òë alugado' : '‚òê alugado'} ${dados.tipo_espaco === 'cedido' ? '‚òë cedido' : '‚òê cedido'}</p>
                        <p><strong>b) Atende aos crit√©rios de acessibilidade?</strong> ${dados.acessibilidade === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_acessibilidade ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_acessibilidade}</p>` : ''}
                        <p><strong>c) Compartilha o espa√ßo com outros servi√ßos?</strong> ${dados.compartilha_espaco === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_compartilhamento ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_compartilhamento}</p>` : ''}
                        <p><strong>d) O espa√ßo atende de forma satisfat√≥ria a execu√ß√£o da oferta socioassistencial?</strong> ${dados.espaco_satisfatorio === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_espaco ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_espaco}</p>` : ''}
                        
                        <h4>2.10. Do car√°ter cont√≠nuo e permanente:</h4>
                        <p><strong>a) Possui atividades de Dezembro a Dezembro?</strong> ${dados.atividades_continuas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        <p><strong>b) Possui recesso/f√©rias coletivas?</strong> ${dados.recesso_ferias === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        
                        <h4>2.11. As a√ß√µes ofertadas s√£o totalmente gratuitas?</h4>
                        <p>${dados.acoes_gratuitas === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.especificar_nao_gratuitas ? `<p><strong>Especifique:</strong> ${dados.especificar_nao_gratuitas}</p>` : ''}
                        ${dados.especificar_bpc ? `<p><strong>Recebe BPC. Especifique:</strong> ${dados.especificar_bpc}</p>` : ''}
                        
                        <h4>2.12. Articula√ß√£o com a rede setorial SUAS e outras redes:</h4>
                        <table border="1" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <tr><th>Rede</th><th>Sim</th><th>N√£o</th><th>Observa√ß√µes</th></tr>
                            <tr><td>CRAS</td><td>${dados.articulacao_cras === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_cras === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_cras || ''}</td></tr>
                            <tr><td>CREAS</td><td>${dados.articulacao_creas === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_creas === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_creas || ''}</td></tr>
                            <tr><td>Sa√∫de</td><td>${dados.articulacao_saude === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_saude === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_saude || ''}</td></tr>
                            <tr><td>Educa√ß√£o</td><td>${dados.articulacao_educacao === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_educacao === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_educacao || ''}</td></tr>
                            <tr><td>Habita√ß√£o</td><td>${dados.articulacao_habitacao === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_habitacao === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_habitacao || ''}</td></tr>
                            <tr><td>Trabalho e Renda</td><td>${dados.articulacao_trabalho === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_trabalho === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_trabalho || ''}</td></tr>
                            <tr><td>Sistema de Justi√ßa</td><td>${dados.articulacao_justica === 'sim' ? '‚òë' : '‚òê'}</td><td>${dados.articulacao_justica === 'nao' ? '‚òë' : '‚òê'}</td><td>${dados.obs_justica || ''}</td></tr>
                        </table>
                        
                        <h4>2.13. As a√ß√µes efetivamente executadas correspondem √† oferta para a qual possui inscri√ß√£o?</h4>
                        <p>${dados.acoes_correspondem === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_acoes_correspondem ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_acoes_correspondem}</p>` : ''}
                        
                        <h4>2.14. A forma de execu√ß√£o (metodologia) das a√ß√µes atende √†s diretrizes das regulamenta√ß√µes?</h4>
                        <p>${dados.metodologia_adequada === 'sim' ? '‚òë sim ‚òê n√£o' : '‚òê sim ‚òë n√£o'}</p>
                        ${dados.obs_metodologia ? `<p><strong>Observa√ß√µes:</strong> ${dados.obs_metodologia}</p>` : ''}
                        
                        <h3>3. DO VOTO</h3>
                        <p><strong>3.1. Quanto √†s an√°lises t√©cnicas elaboradas pela Secretaria Executiva, o Relator:</strong></p>
                        <p>${dados.concordancia_analises === 'concorda' ? '‚òë concorda ‚òê discorda' : '‚òê concorda ‚òë discorda'}</p>
                        ${dados.fundamentos_discordancia ? `<p><strong>Fundamentos:</strong> ${dados.fundamentos_discordancia}</p>` : ''}
                        
                        <p><strong>3.2. O(A) Conselheiro(a) vota pelo(a):</strong></p>
                        <p>${dados.voto_final === 'Indeferimento do pedido quanto √† oferta analisada' ? '‚òë' : '‚òê'} Indeferimento do pedido quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Deferimento do pedido quanto √† oferta analisada' ? '‚òë' : '‚òê'} Deferimento do pedido quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada' ? '‚òë' : '‚òê'} Manuten√ß√£o da inscri√ß√£o quanto √† oferta analisada</p>
                        <p>${dados.voto_final === 'Cancelamento da inscri√ß√£o quanto √† oferta analisada' ? '‚òë' : '‚òê'} Cancelamento da inscri√ß√£o quanto √† oferta analisada</p>
                        
                        <div style="margin-top: 40px; padding: 20px; border: 2px solid #48bb78; border-radius: 10px; background: #f0fff4;">
                            <h4 style="color: #38a169;">‚úÖ DOCUMENTO OFICIAL CAS-DF</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 12px; margin: 15px 0;">
                                <p><strong>N√∫mero do Documento:</strong> ${numeroDocumento}</p>
                                <p><strong>Data/Hora de Assinatura:</strong> ${document.getElementById('signatureDateTime')?.textContent || 'N/A'}</p>
                                <p><strong>Conselheiro Respons√°vel:</strong> ${dados.nome_conselheiro}</p>
                                <p><strong>CPF:</strong> ${dados.cpf_conselheiro}</p>
                                <p><strong>Entidade Fiscalizada:</strong> ${dados.nome_entidade}</p>
                                <p><strong>CNPJ:</strong> ${dados.cnpj_entidade}</p>
                            </div>
                            <p style="font-size: 11px; margin: 10px 0;"><strong>Hash de Verifica√ß√£o:</strong> ${hashDocumento}</p>
                            <p style="font-size: 10px; color: #666; margin: 10px 0; text-align: center;">
                                Este documento foi assinado digitalmente e possui validade legal conforme MP 2.200-2/2001
                            </p>
                        </div>
                        
                        <div style="margin-top: 40px;">
                            <p><strong>Seja o presente voto submetido √† delibera√ß√£o da plen√°ria.</strong></p>
                            <p style="margin-top: 30px;">${dados.data_voto ? new Date(dados.data_voto).toLocaleDateString('pt-BR') : '____'}</p>
                            <div style="margin-top: 50px; border-top: 1px solid black; width: 300px; text-align: center;">
                                <p>${dados.nome_conselheiro}</p>
                                <p>Conselheiro(a)</p>
                            </div>
                        </div>
                    </div>
                `;

                const reportContentEl = document.getElementById('reportContent');
                const reportSectionEl = document.getElementById('reportSection');
                const formEl = document.getElementById('fiscalizacaoForm');

                if (reportContentEl) reportContentEl.innerHTML = relatorio;
                if (reportSectionEl) reportSectionEl.style.display = 'block';
                if (formEl) formEl.style.display = 'none';
                
                // Scroll para o topo do relat√≥rio
                if (reportSectionEl) {
                    reportSectionEl.scrollIntoView({ behavior: 'smooth' });
                }

                mostrarNotificacao('Relat√≥rio gerado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                mostrarNotificacao('Erro ao gerar relat√≥rio. Tente novamente.', 'error');
            }
        }

        // Fun√ß√µes de rascunho ATUALIZADAS (com fotos)
        function salvarRascunho() {
            try {
                const form = document.getElementById('fiscalizacaoForm');
                if (!form) throw new Error('Formul√°rio n√£o encontrado');

                const formData = new FormData(form);
                const dados = Object.fromEntries(formData.entries());
                
                const servicosSelecionados = Array.from(document.querySelectorAll('input[name="tipoServico"]:checked'))
                    .map(cb => cb.value);
                dados.tipoServico = servicosSelecionados;
                
                // NOVO: Incluir fotos no rascunho
                const totalFotos = Object.values(fotosFiscalizacao).reduce((acc, arr) => acc + arr.length, 0);
                dados.fotos = fotosFiscalizacao;
                dados.totalFotos = totalFotos;
                
                localStorage.setItem('cas_rascunho', JSON.stringify(dados));
                localStorage.setItem('cas_rascunho_data', new Date().toISOString());
                
                mostrarNotificacao(`Rascunho salvo com sucesso! ${totalFotos > 0 ? `(${totalFotos} fotos inclu√≠das)` : ''}`, 'success');
            } catch (error) {
                console.error('Erro ao salvar rascunho:', error);
                mostrarNotificacao('Erro ao salvar rascunho.', 'error');
            }
        }

        function carregarRascunho() {
            try {
                const rascunho = localStorage.getItem('cas_rascunho');
                
                if (!rascunho) {
                    mostrarNotificacao('Nenhum rascunho encontrado', 'error');
                    return;
                }

                const dados = JSON.parse(rascunho);
                
                // Carregar dados do formul√°rio (fun√ß√£o original)
                Object.keys(dados).forEach(key => {
                    if (Array.isArray(dados[key]) && key !== 'tipoServico' && key !== 'fotos') return;
                    if (key === 'fotos' || key === 'totalFotos') return; // Pular dados de fotos por enquanto
                    
                    const elemento = document.querySelector(`[name="${key}"]`);
                    if (elemento) {
                        if (elemento.type === 'radio') {
                            const radio = document.querySelector(`[name="${key}"][value="${dados[key]}"]`);
                            if (radio) radio.checked = true;
                        } else if (elemento.type === 'checkbox' && key !== 'declaracao_veracidade' && key !== 'confirma_assinatura') {
                            elemento.checked = dados[key] === 'on';
                        } else {
                            elemento.value = dados[key];
                        }
                    }
                });

                // Carregar servi√ßos selecionados
                if (dados.tipoServico && Array.isArray(dados.tipoServico)) {
                    dados.tipoServico.forEach(valor => {
                        const checkbox = document.querySelector(`[name="tipoServico"][value="${valor}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }

                // NOVO: Carregar fotos do rascunho
                if (dados.fotos) {
                    fotosFiscalizacao = dados.fotos;
                    
                    // Renderizar fotos na interface
                    Object.keys(fotosFiscalizacao).forEach(categoria => {
                        const grid = document.getElementById(`fotos-${categoria}`);
                        if (grid) grid.innerHTML = ''; // Limpar antes
                        
                        fotosFiscalizacao[categoria].forEach(foto => {
                            renderizarFotoNaCategoria(foto, categoria);
                        });
                    });
                    
                    atualizarContadorFotos();
                }

                const dataRascunho = localStorage.getItem('cas_rascunho_data');
                const dataFormatada = new Date(dataRascunho).toLocaleString();
                
                const totalFotos = dados.totalFotos || 0;
                mostrarNotificacao(`Rascunho carregado! (salvo em ${dataFormatada})${totalFotos > 0 ? ` - ${totalFotos} fotos restauradas` : ''}`, 'info');
            } catch (error) {
                console.error('Erro ao carregar rascunho:', error);
                mostrarNotificacao('Erro ao carregar rascunho', 'error');
            }
        }

        function limparFormulario() {
            try {
                if (confirm('Tem certeza que deseja limpar todos os dados E FOTOS?')) {
                    const form = document.getElementById('fiscalizacaoForm');
                    if (form) form.reset();
                    
                    assinaturaValida = false;
                    hashDocumento = '';
                    
                    // NOVO: Limpar fotos tamb√©m
                    Object.keys(fotosFiscalizacao).forEach(categoria => {
                        fotosFiscalizacao[categoria] = [];
                        const grid = document.getElementById(`fotos-${categoria}`);
                        if (grid) grid.innerHTML = '';
                    });
                    atualizarContadorFotos();
                    
                    const signatureInfo = document.getElementById('signatureInfo');
                    const cpfEl = document.getElementById('cpf_conselheiro');
                    const cnpjEl = document.getElementById('cnpj_entidade');
                    const confirmaEl = document.getElementById('confirma_assinatura');
                    
                    if (signatureInfo) signatureInfo.style.display = 'none';
                    if (cpfEl) cpfEl.removeAttribute('readonly');
                    if (cnpjEl) cnpjEl.removeAttribute('readonly');
                    if (confirmaEl) confirmaEl.disabled = false;
                    
                    localStorage.removeItem('cas_rascunho');
                    localStorage.removeItem('cas_rascunho_data');
                    
                    verificarLiberacaoRelatorio();
                    
                    mostrarNotificacao('Formul√°rio e fotos limpos com sucesso!', 'info');
                }
            } catch (error) {
                console.error('Erro ao limpar formul√°rio:', error);
                mostrarNotificacao('Erro ao limpar formul√°rio.', 'error');
            }
        }

        function gerarPDF() {
            try {
                const conteudoImpressao = `
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Relat√≥rio CAS-DF - ${numeroDocumento}</title>
                        <style>
                            @media print {
                                @page { margin: 2cm; size: A4; }
                                body { font-family: Arial, sans-serif; font-size: 11px; line-height: 1.3; color: black; background: white; }
                                table { border-collapse: collapse; width: 100%; page-break-inside: avoid; }
                                th, td { border: 1px solid #000; padding: 4px; font-size: 10px; }
                                h3, h4 { color: #000; page-break-after: avoid; margin-top: 15px; margin-bottom: 8px; }
                                .no-print { display: none !important; }
                            }
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
                            table { border-collapse: collapse; width: 100%; margin: 10px 0; }
                            th, td { border: 1px solid #000; padding: 6px; text-align: left; }
                            th { background-color: #f0f0f0; font-weight: bold; }
                            h3, h4 { color: #2d3748; margin-top: 20px; margin-bottom: 10px; }
                            p { margin: 6px 0; }
                            .header-oficial { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 15px; }
                        </style>
                    </head>
                    <body>
                        <div class="header-oficial">
                            <h1>CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL</h1>
                            <p>SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF - CEP 70.770-502</p>
                            <p>E-mail: Cas_df@sedes.df.gov.br</p>
                            <h2>FICHA DE RELATO DE FISCALIZA√á√ÉO</h2>
                            <p><strong>Documento N¬∫: ${numeroDocumento}</strong></p>
                        </div>
                        ${document.getElementById('reportContent')?.innerHTML || ''}
                    </body>
                    </html>
                `;
                
                const janelaImpressao = window.open('', '_blank');
                if (janelaImpressao) {
                    janelaImpressao.document.write(conteudoImpressao);
                    janelaImpressao.document.close();
                    
                    setTimeout(() => {
                        janelaImpressao.print();
                        janelaImpressao.close();
                    }, 500);
                }
                
                mostrarNotificacao('üìÑ PDF gerado! Use Ctrl+P para salvar como PDF', 'success');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                mostrarNotificacao('Erro ao gerar PDF.', 'error');
            }
        }

        function voltarFormulario() {
            try {
                const reportSectionEl = document.getElementById('reportSection');
                const formEl = document.getElementById('fiscalizacaoForm');

                if (reportSectionEl) reportSectionEl.style.display = 'none';
                if (formEl) formEl.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error('Erro ao voltar ao formul√°rio:', error);
            }
        }

        function exportarHTML() {
            try {
                const htmlCompleto = document.documentElement.outerHTML;
                const blob = new Blob([htmlCompleto], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sistema_cas_completo_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                mostrarNotificacao('üì• Sistema completo exportado!', 'success');
            } catch (error) {
                console.error('Erro ao exportar HTML:', error);
                mostrarNotificacao('Erro ao exportar sistema.', 'error');
            }
        }

        function imprimirRelatorio() {
            try {
                mostrarNotificacao('üñ®Ô∏è Abrindo janela de impress√£o...', 'info');
                setTimeout(() => {
                    window.print();
                }, 500);
            } catch (error) {
                console.error('Erro ao imprimir:', error);
                mostrarNotificacao('Erro ao imprimir.', 'error');
            }
        }

        // Fun√ß√£o completa de envio de email com PDF
        function enviarEmail() {
            try {
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    mostrarNotificacao('‚ùå Gere o relat√≥rio primeiro antes de enviar por email', 'error');
                    return;
                }
                
                // Preparar dados do email
                const assunto = `Relat√≥rio de Fiscaliza√ß√£o CAS-DF - ${dadosRelatorio.numeroDocumento}`;
                const nomeArquivo = `Relatorio_CAS_${dadosRelatorio.numeroDocumento.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                
                const corpoEmail = `Prezados,

Segue em anexo o Relat√≥rio de Fiscaliza√ß√£o do Conselho de Assist√™ncia Social do Distrito Federal (CAS-DF).

DADOS DO DOCUMENTO:
‚Ä¢ N√∫mero: ${dadosRelatorio.numeroDocumento}
‚Ä¢ Entidade Fiscalizada: ${dadosRelatorio.entidade}
‚Ä¢ CNPJ: ${dadosRelatorio.cnpj}
‚Ä¢ Conselheiro Respons√°vel: ${dadosRelatorio.conselheiro}
‚Ä¢ Data/Hora de Assinatura: ${dadosRelatorio.timestamp}

VERIFICA√á√ÉO DE AUTENTICIDADE:
‚Ä¢ Hash de Verifica√ß√£o: ${dadosRelatorio.hash}
‚Ä¢ Este documento foi assinado digitalmente e possui validade legal conforme MP 2.200-2/2001

O relat√≥rio completo est√° em anexo no formato PDF.

Atenciosamente,
${dadosRelatorio.conselheiro}
Conselheiro(a) do CAS-DF

---
CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL
SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF
CEP 70.770-502 | E-mail: Cas_df@sedes.df.gov.br`;
                
                // Preencher modal com destinat√°rio padr√£o CAS-DF
                document.getElementById('email_destinatario').value = 'Cas_df@sedes.df.gov.br';
                document.getElementById('email_assunto').value = assunto;
                document.getElementById('email_corpo').value = corpoEmail;
                document.getElementById('nome_arquivo_email').textContent = nomeArquivo;
                
                // Mostrar modal
                document.getElementById('emailModal').style.display = 'block';
                
                mostrarNotificacao('üìß Pronto para enviar para o CAS-DF!', 'success');
            } catch (error) {
                console.error('Erro ao preparar email:', error);
                mostrarNotificacao('‚ùå Erro ao preparar email', 'error');
            }
        }
        
        function abrirClienteEmail() {
            try {
                const destinatario = document.getElementById('email_destinatario').value;
                const copia = document.getElementById('email_copia').value;
                const assunto = document.getElementById('email_assunto').value;
                const corpo = document.getElementById('email_corpo').value;
                
                if (!destinatario) {
                    mostrarNotificacao('‚ùå Destinat√°rio n√£o pode estar vazio', 'error');
                    return;
                }
                
                // Construir URL mailto
                let mailtoUrl = `mailto:${destinatario}`;
                const params = [];
                
                if (copia) params.push(`cc=${encodeURIComponent(copia)}`);
                if (assunto) params.push(`subject=${encodeURIComponent(assunto)}`);
                if (corpo) params.push(`body=${encodeURIComponent(corpo)}`);
                
                if (params.length > 0) {
                    mailtoUrl += '?' + params.join('&');
                }
                
                // Abrir cliente de email
                window.location.href = mailtoUrl;
                
                mostrarNotificacao('üìß Cliente de email aberto! IMPORTANTE: Anexe manualmente o PDF antes de enviar.', 'info', 8000);
                fecharEmailModal();
                
                // Oferecer download autom√°tico do PDF
                setTimeout(() => {
                    if (confirm('Deseja baixar o PDF agora para anexar ao email?')) {
                        gerarPDF();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao abrir cliente de email:', error);
                mostrarNotificacao('‚ùå Erro ao abrir cliente de email', 'error');
            }
        }
        
        function enviarEmailDireto() {
            try {
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    mostrarNotificacao('‚ùå Gere o relat√≥rio primeiro', 'error');
                    return;
                }
                
                // Preparar dados para envio direto
                const assunto = `Relat√≥rio de Fiscaliza√ß√£o CAS-DF - ${dadosRelatorio.numeroDocumento}`;
                const corpo = `Relat√≥rio de Fiscaliza√ß√£o enviado automaticamente.
                
Documento: ${dadosRelatorio.numeroDocumento}
Entidade: ${dadosRelatorio.entidade}
Conselheiro: ${dadosRelatorio.conselheiro}
Data: ${dadosRelatorio.timestamp}
Hash: ${dadosRelatorio.hash}`;
                
                // Construir mailto com dados do CAS-DF
                const mailtoUrl = `mailto:Cas_df@sedes.df.gov.br?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
                
                // Abrir cliente de email
                window.location.href = mailtoUrl;
                
                // Baixar PDF automaticamente
                setTimeout(() => {
                    gerarPDF();
                    mostrarNotificacao('üìß Email aberto e PDF baixado! Anexe o arquivo ao email.', 'success', 6000);
                }, 500);
                
            } catch (error) {
                console.error('Erro no envio direto:', error);
                mostrarNotificacao('‚ùå Erro no envio de email', 'error');
            }
        }
        
        // Fun√ß√£o melhorada para gerar PDF otimizado para email
        function gerarPDFParaEmail() {
            try {
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    mostrarNotificacao('‚ùå Gere o relat√≥rio primeiro', 'error');
                    return;
                }
                
                const reportContent = document.getElementById('reportContent')?.innerHTML;
                if (!reportContent) {
                    mostrarNotificacao('‚ùå Conte√∫do do relat√≥rio n√£o encontrado', 'error');
                    return;
                }
                
                const conteudoPDF = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio CAS-DF - ${dadosRelatorio.numeroDocumento}</title>
    <style>
        @page { 
            margin: 2cm; 
            size: A4; 
            @bottom-right {
                content: "P√°gina " counter(page) " de " counter(pages);
                font-size: 10px;
            }
        }
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 12px; 
            line-height: 1.4; 
            color: #000; 
            background: #fff;
            margin: 0;
            padding: 0;
        }
        .header-oficial { 
            text-align: center; 
            margin-bottom: 30px; 
            border-bottom: 2px solid #000; 
            padding-bottom: 15px; 
        }
        .header-oficial h1 { 
            font-size: 16px; 
            margin: 10px 0; 
            font-weight: bold;
        }
        .header-oficial h2 { 
            font-size: 14px; 
            margin: 10px 0; 
            font-weight: bold;
        }
        .header-oficial p { 
            font-size: 11px; 
            margin: 5px 0; 
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 10px 0; 
            page-break-inside: avoid;
        }
        th, td { 
            border: 1px solid #000; 
            padding: 6px; 
            text-align: left; 
            font-size: 11px;
            vertical-align: top;
        }
        th { 
            background-color: #f0f0f0; 
            font-weight: bold; 
        }
        h3, h4 { 
            color: #000; 
            margin-top: 20px; 
            margin-bottom: 10px; 
            page-break-after: avoid;
            font-weight: bold;
        }
        h3 { font-size: 14px; }
        h4 { font-size: 13px; }
        p { 
            margin: 8px 0; 
            text-align: justify;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        li {
            margin: 5px 0;
        }
        .assinatura-digital {
            margin-top: 30px;
            padding: 15px;
            border: 2px solid #2d5a27;
            border-radius: 5px;
            background: #f8fff8;
            page-break-inside: avoid;
        }
        .assinatura-digital h4 {
            color: #2d5a27;
            margin-bottom: 10px;
        }
        .dados-assinatura {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 11px;
        }
        .hash-verificacao {
            font-family: 'Courier New', monospace;
            background: #f0f0f0;
            padding: 5px;
            border: 1px solid #ccc;
            word-break: break-all;
            font-size: 10px;
        }
        .footer-legal {
            font-size: 10px;
            text-align: center;
            margin-top: 15px;
            color: #666;
        }
        @media print {
            body { print-color-adjust: exact; }
            .assinatura-digital { background: #f8fff8 !important; }
        }
    </style>
</head>
<body>
    <div class="header-oficial">
        <h1>CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL</h1>
        <p><strong>SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF - CEP 70.770-502</strong></p>
        <p><strong>E-mail: Cas_df@sedes.df.gov.br</strong></p>
        <h2>FICHA DE RELATO DE FISCALIZA√á√ÉO</h2>
        <p><strong>Documento N¬∫: ${dadosRelatorio.numeroDocumento}</strong></p>
        <p><strong>Data de Gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</strong></p>
    </div>
    
    ${reportContent}
    
    <div class="assinatura-digital">
        <h4>‚úÖ DOCUMENTO OFICIAL CAS-DF - ASSINADO DIGITALMENTE</h4>
        <div class="dados-assinatura">
            <p><strong>N√∫mero do Documento:</strong> ${dadosRelatorio.numeroDocumento}</p>
            <p><strong>Data/Hora de Assinatura:</strong> ${dadosRelatorio.timestamp}</p>
            <p><strong>Conselheiro Respons√°vel:</strong> ${dadosRelatorio.conselheiro}</p>
            <p><strong>CPF:</strong> ${dadosRelatorio.cpf}</p>
            <p><strong>Entidade Fiscalizada:</strong> ${dadosRelatorio.entidade}</p>
            <p><strong>CNPJ:</strong> ${dadosRelatorio.cnpj}</p>
        </div>
        <p style="margin: 15px 0 5px 0;"><strong>Hash de Verifica√ß√£o:</strong></p>
        <div class="hash-verificacao">${dadosRelatorio.hash}</div>
        <div class="footer-legal">
            Este documento foi assinado digitalmente e possui validade legal conforme MP 2.200-2/2001.<br>
            Para verificar a autenticidade, utilize o hash de verifica√ß√£o informado acima.
        </div>
    </div>
</body>
</html>`;
                
                const janelaImpressao = window.open('', '_blank', 'width=800,height=600');
                if (janelaImpressao) {
                    janelaImpressao.document.write(conteudoPDF);
                    janelaImpressao.document.close();
                    
                    // Aguardar carregar e abrir dialog de impress√£o
                    setTimeout(() => {
                        janelaImpressao.focus();
                        janelaImpressao.print();
                    }, 1000);
                }
                
                mostrarNotificacao('üìÑ PDF otimizado gerado! Use Ctrl+P ‚Üí "Salvar como PDF" para baixar.', 'success', 6000);
                
            } catch (error) {
                console.error('Erro ao gerar PDF para email:', error);
                mostrarNotificacao('‚ùå Erro ao gerar PDF', 'error');
            }
        }
        
        function copiarTextoEmail() {
            try {
                const destinatario = document.getElementById('email_destinatario').value;
                const copia = document.getElementById('email_copia').value;
                const assunto = document.getElementById('email_assunto').value;
                const corpo = document.getElementById('email_corpo').value;
                
                const textoCompleto = `
PARA: ${destinatario}
${copia ? `CC: ${copia}` : ''}
ASSUNTO: ${assunto}

${corpo}
                `.trim();
                
                // Copiar para clipboard
                navigator.clipboard.writeText(textoCompleto).then(() => {
                    mostrarNotificacao('üìã Texto do email copiado! Cole no seu cliente de email.', 'success');
                }).catch(() => {
                    // Fallback para navegadores mais antigos
                    const textArea = document.createElement('textarea');
                    textArea.value = textoCompleto;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    mostrarNotificacao('üìã Texto copiado! Cole no seu cliente de email.', 'success');
                });
                
            } catch (error) {
                console.error('Erro ao copiar texto:', error);
                mostrarNotificacao('‚ùå Erro ao copiar texto', 'error');
            }
        }
        
        function verificarDocumento() {
            try {
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    mostrarNotificacao('‚ùå Gere o relat√≥rio primeiro para verificar', 'error');
                    return;
                }
                
                // Preencher dados do modal de verifica√ß√£o
                document.getElementById('numero_documento_verify').textContent = dadosRelatorio.numeroDocumento;
                document.getElementById('hash_documento_verify').textContent = dadosRelatorio.hash;
                document.getElementById('timestamp_verify').textContent = dadosRelatorio.timestamp;
                document.getElementById('conselheiro_verify').textContent = dadosRelatorio.conselheiro;
                document.getElementById('cpf_verify').textContent = dadosRelatorio.cpf;
                
                // Gerar QR Code simples (texto)
                const qrData = `CAS-DF|${dadosRelatorio.numeroDocumento}|${dadosRelatorio.hash}|${dadosRelatorio.timestamp}`;
                document.getElementById('qrcode').innerHTML = `
                    <div style="font-family: monospace; font-size: 10px; word-break: break-all; max-width: 200px; padding: 10px; border: 1px solid #ccc;">
                        ${qrData}
                    </div>
                    <p style="font-size: 12px; margin-top: 10px;">C√≥digo de verifica√ß√£o QR</p>
                `;
                
                // Mostrar modal
                document.getElementById('verificacaoModal').style.display = 'block';
                
                mostrarNotificacao('üîç Dados de verifica√ß√£o exibidos!', 'success');
            } catch (error) {
                console.error('Erro ao verificar documento:', error);
                mostrarNotificacao('‚ùå Erro ao verificar documento', 'error');
            }
        }
        
        function fecharEmailModal() { 
            const modal = document.getElementById('emailModal'); 
            if (modal) modal.style.display = 'none'; 
        }
        
        function fecharVerificacaoModal() { 
            const modal = document.getElementById('verificacaoModal'); 
            if (modal) modal.style.display = 'none'; 
        }
        
        // Sistema de teste e debug
        function testarFuncionalidades() {
            console.log('üß™ Iniciando testes das funcionalidades...');
            
            // Teste 1: Verificar elementos DOM essenciais
            const elementosEssenciais = [
                'fiscalizacaoForm',
                'btnRelatorio',
                'reportSection',
                'reportContent',
                'emailModal',
                'verificacaoModal',
                'notification'
            ];
            
            elementosEssenciais.forEach(id => {
                const elemento = document.getElementById(id);
                console.log(`${elemento ? '‚úÖ' : '‚ùå'} ${id}: ${elemento ? 'Encontrado' : 'N√ÉO ENCONTRADO'}`);
            });
            
            // Teste 2: Verificar vari√°veis globais
            console.log('üìä Vari√°veis globais:');
            console.log(`- assinaturaValida: ${assinaturaValida}`);
            console.log(`- hashDocumento: ${hashDocumento || 'vazio'}`);
            console.log(`- numeroDocumento: ${numeroDocumento || 'vazio'}`);
            console.log(`- dadosRelatorio:`, dadosRelatorio);
            
            // Teste 3: Verificar localStorage
            console.log('üíæ localStorage:');
            console.log(`- Contador: ${localStorage.getItem('cas_contador_documentos') || 'vazio'}`);
            console.log(`- Rascunho: ${localStorage.getItem('cas_rascunho') ? 'existe' : 'vazio'}`);
            
            mostrarNotificacao('üß™ Teste completo! Verifique o console (F12)', 'info');
        }

        // Fun√ß√£o de diagn√≥stico melhorada
        function diagnosticoSistema() {
            try {
                console.log('üîç === DIAGN√ìSTICO DO SISTEMA ===');
                
                // 1. Testar gera√ß√£o de n√∫mero do documento
                console.log('1. Testando gera√ß√£o de n√∫mero...');
                const numeroTeste = gerarNumeroDocumento();
                console.log(`‚úÖ N√∫mero gerado: ${numeroDocumento}`);
                
                // 2. Testar valida√ß√µes
                console.log('2. Testando valida√ß√µes...');
                console.log(`CPF 12345678901: ${validarCPF('12345678901') ? '‚ùå V√°lido (erro!)' : '‚úÖ Inv√°lido (correto)'}`);
                console.log(`CPF 11144477735: ${validarCPF('11144477735') ? '‚úÖ V√°lido' : '‚ùå Inv√°lido'}`);
                console.log(`CNPJ 11444777000161: ${validarCNPJ('11444777000161') ? '‚úÖ V√°lido' : '‚ùå Inv√°lido'}`);
                
                // 3. Testar notifica√ß√µes
                console.log('3. Testando notifica√ß√µes...');
                setTimeout(() => mostrarNotificacao('‚úÖ Teste Success', 'success'), 1000);
                setTimeout(() => mostrarNotificacao('‚ùå Teste Error', 'error'), 2000);
                setTimeout(() => mostrarNotificacao('‚ÑπÔ∏è Teste Info', 'info'), 3000);
                
                // 4. Verificar elementos do formul√°rio
                console.log('4. Verificando formul√°rio...');
                const form = document.getElementById('fiscalizacaoForm');
                if (form) {
                    const inputs = form.querySelectorAll('input, select, textarea');
                    console.log(`‚úÖ Formul√°rio encontrado com ${inputs.length} campos`);
                } else {
                    console.log('‚ùå Formul√°rio n√£o encontrado');
                }
                
                // 5. Testar m√°scaras
                console.log('5. Testando m√°scaras...');
                const cpfInput = document.getElementById('cpf_conselheiro');
                const cnpjInput = document.getElementById('cnpj_entidade');
                console.log(`CPF input: ${cpfInput ? '‚úÖ' : '‚ùå'}`);
                console.log(`CNPJ input: ${cnpjInput ? '‚úÖ' : '‚ùå'}`);
                
                mostrarNotificacao('üîç Diagn√≥stico completo! Verifique o console', 'info');
                
            } catch (error) {
                console.error('‚ùå Erro no diagn√≥stico:', error);
                mostrarNotificacao('‚ùå Erro no diagn√≥stico', 'error');
            }
        }

        // Teste espec√≠fico para email
        function testarEmail() {
            try {
                console.log('üìß === TESTE DE EMAIL ===');
                
                // Simular dados do relat√≥rio para teste
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    dadosRelatorio = {
                        numeroDocumento: 'CAS-DF-2025-TESTE',
                        conselheiro: 'Teste Conselheiro',
                        cpf: '111.444.777-35',
                        entidade: 'Entidade Teste',
                        cnpj: '11.444.777/0001-61',
                        timestamp: new Date().toLocaleString('pt-BR'),
                        hash: 'TESTE123456789'
                    };
                    console.log('‚úÖ Dados de teste criados');
                }
                
                // Testar prepara√ß√£o do email
                const modal = document.getElementById('emailModal');
                if (modal) {
                    enviarEmail();
                    console.log('‚úÖ Fun√ß√£o enviarEmail() executada');
                } else {
                    console.log('‚ùå Modal de email n√£o encontrado');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste de email:', error);
                mostrarNotificacao('‚ùå Erro no teste de email', 'error');
            }
        }

        // Teste de responsividade
        function testarResponsividade() {
            try {
                console.log('üì± === TESTE DE RESPONSIVIDADE ===');
                
                const largura = window.innerWidth;
                console.log(`Largura atual: ${largura}px`);
                
                if (largura <= 768) {
                    console.log('‚úÖ Modo mobile detectado');
                    mostrarNotificacao('üì± Modo mobile ativo', 'info');
                } else {
                    console.log('‚úÖ Modo desktop detectado');
                    mostrarNotificacao('üñ•Ô∏è Modo desktop ativo', 'info');
                }
                
                // Testar elementos responsivos
                const botoes = document.querySelectorAll('.btn');
                console.log(`Bot√µes encontrados: ${botoes.length}`);
                
                const formulario = document.querySelector('.form-section');
                if (formulario) {
                    console.log('‚úÖ Se√ß√£o de formul√°rio encontrada');
                } else {
                    console.log('‚ùå Se√ß√£o de formul√°rio n√£o encontrada');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste de responsividade:', error);
            }
        }

        // Adicionar bot√µes de teste (apenas para desenvolvimento)
        function adicionarBotoesTeste() {
            const botoesExistentes = document.querySelector('.action-buttons');
            if (botoesExistentes && !document.getElementById('botoes-teste')) {
                const divTeste = document.createElement('div');
                divTeste.id = 'botoes-teste';
                divTeste.style.cssText = 'margin-top: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px;';
                divTeste.innerHTML = `
                    <h4 style="margin: 0 0 10px 0; color: #856404;">üß™ Testes de Desenvolvimento</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="diagnosticoSistema()" class="btn btn-secondary" style="font-size: 12px; padding: 8px 15px;">üîç Diagn√≥stico</button>
                        <button onclick="testarFuncionalidades()" class="btn btn-secondary" style="font-size: 12px; padding: 8px 15px;">üß™ Testar Fun√ß√µes</button>
                        <button onclick="testarEmail()" class="btn btn-secondary" style="font-size: 12px; padding: 8px 15px;">üìß Testar Email</button>
                        <button onclick="testarResponsividade()" class="btn btn-secondary" style="font-size: 12px; padding: 8px 15px;">üì± Responsividade</button>
                        <button onclick="document.getElementById('botoes-teste').remove()" class="btn btn-danger" style="font-size: 12px; padding: 8px 15px;">‚ùå Remover Testes</button>
                    </div>
                `;
                botoesExistentes.after(divTeste);
            }
        }

        // Corrigir fun√ß√£o gerarNumeroDocumento para retornar valor
        function gerarNumeroDocumento() {
            try {
                const ano = new Date().getFullYear();
                const contador = localStorage.getItem('cas_contador_documentos') || '0';
                const novoContador = String(parseInt(contador) + 1).padStart(4, '0');
                numeroDocumento = `CAS-DF-${ano}-${novoContador}`;
                localStorage.setItem('cas_contador_documentos', novoContador);
                return numeroDocumento;
            } catch (error) {
                console.error('Erro ao gerar n√∫mero do documento:', error);
                numeroDocumento = `CAS-DF-${new Date().getFullYear()}-${Date.now()}`;
                return numeroDocumento;
            }
        }

        // Melhorar fun√ß√£o salvarRelatorio
        function salvarRelatorio() {
            try {
                if (!dadosRelatorio || !dadosRelatorio.numeroDocumento) {
                    mostrarNotificacao('‚ùå Gere o relat√≥rio primeiro', 'error');
                    return;
                }
                
                const reportContent = document.getElementById('reportContent')?.innerHTML;
                if (!reportContent) {
                    mostrarNotificacao('‚ùå Conte√∫do do relat√≥rio n√£o encontrado', 'error');
                    return;
                }
                
                const htmlCompleto = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio CAS-DF - ${dadosRelatorio.numeroDocumento}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #000; padding: 6px; text-align: left; }
        th { background-color: #f0f0f0; font-weight: bold; }
        h3, h4 { color: #2d3748; margin-top: 20px; margin-bottom: 10px; }
        p { margin: 6px 0; }
        .header-oficial { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 15px; }
        @media print { body { margin: 0; } }
    </style>
</head>
<body>
    <div class="header-oficial">
        <h1>CONSELHO DE ASSIST√äNCIA SOCIAL DO DISTRITO FEDERAL</h1>
        <p>SEPN Quadra 515 Lote 02 Bloco B, 4¬∫ andar - Asa Norte/DF - CEP 70.770-502</p>
        <p>E-mail: Cas_df@sedes.df.gov.br</p>
        <h2>FICHA DE RELATO DE FISCALIZA√á√ÉO</h2>
        <p><strong>Documento N¬∫: ${dadosRelatorio.numeroDocumento}</strong></p>
    </div>
    ${reportContent}
</body>
</html>`;
                
                const blob = new Blob([htmlCompleto], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Relatorio_CAS_${dadosRelatorio.numeroDocumento.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                mostrarNotificacao('üíæ Backup HTML salvo com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao salvar relat√≥rio:', error);
                mostrarNotificacao('‚ùå Erro ao salvar backup', 'error');
            }
        }

        // Adicionar evento para fechar modais ao clicar fora
        window.addEventListener('click', function(event) {
            const emailModal = document.getElementById('emailModal');
            const verificacaoModal = document.getElementById('verificacaoModal');
            
            if (event.target === emailModal) {
                fecharEmailModal();
            }
            if (event.target === verificacaoModal) {
                fecharVerificacaoModal();
            }
        });

        // Auto-executar teste inicial ap√≥s carregamento
        setTimeout(() => {
            console.log('üöÄ Sistema CAS-DF carregado!');
            console.log('üí° Execute diagnosticoSistema() no console para verificar o sistema');
            console.log('üí° Execute adicionarBotoesTeste() para adicionar bot√µes de teste');
            
            // Verifica√ß√£o autom√°tica b√°sica
            const erros = [];
            
            if (!document.getElementById('fiscalizacaoForm')) erros.push('Formul√°rio principal');
            if (!document.getElementById('btnRelatorio')) erros.push('Bot√£o de relat√≥rio');
            if (!document.getElementById('emailModal')) erros.push('Modal de email');
            
            if (erros.length > 0) {
                console.warn('‚ö†Ô∏è Elementos n√£o encontrados:', erros.join(', '));
                mostrarNotificacao('‚ö†Ô∏è Alguns elementos podem n√£o estar funcionando', 'warning');
            } else {
                console.log('‚úÖ Todos os elementos essenciais encontrados');
                mostrarNotificacao('‚úÖ Sistema inicializado com sucesso!', 'success', 3000);
            }
        }, 2000);

        // Verifica√ß√£o de funcionalidades ao gerar relat√≥rio
        const originalGerarRelatorio = gerarRelatorio;
        gerarRelatorio = function() {
            console.log('üìä Executando gera√ß√£o de relat√≥rio...');
            try {
                const resultado = originalGerarRelatorio();
                console.log('‚úÖ Relat√≥rio gerado com sucesso');
                
                // Verificar se os dados foram salvos corretamente
                if (dadosRelatorio && dadosRelatorio.numeroDocumento) {
                    console.log('‚úÖ Dados do relat√≥rio salvos:', dadosRelatorio);
                } else {
                    console.warn('‚ö†Ô∏è Dados do relat√≥rio podem n√£o ter sido salvos corretamente');
                }
                
                return resultado;
            } catch (error) {
                console.error('‚ùå Erro na gera√ß√£o do relat√≥rio:', error);
                throw error;
            }
        };

        // Debug de eventos
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('btn')) {
                console.log(`üîò Bot√£o clicado: ${event.target.textContent.trim()}`);
            }
        });

        // Verifica√ß√£o final do sistema
        window.verificarSistema = function() {
            console.log('üîç === VERIFICA√á√ÉO FINAL DO SISTEMA ===');
            
            const checklist = [
                { nome: 'Formul√°rio principal', check: () => !!document.getElementById('fiscalizacaoForm') },
                { nome: 'M√°scaras CPF/CNPJ', check: () => {
                    const cpf = document.getElementById('cpf_conselheiro');
                    const cnpj = document.getElementById('cnpj_entidade');
                    return cpf && cnpj;
                }},
                { nome: 'Valida√ß√£o CPF', check: () => validarCPF('11144477735') },
                { nome: 'Valida√ß√£o CNPJ', check: () => validarCNPJ('11444777000161') },
                { nome: 'Gera√ß√£o de n√∫mero', check: () => {
                    const teste = gerarNumeroDocumento();
                    return teste && teste.includes('CAS-DF');
                }},
                { nome: 'Sistema de notifica√ß√µes', check: () => !!document.getElementById('notification') },
                { nome: 'Modal de email', check: () => !!document.getElementById('emailModal') },
                { nome: 'Modal de verifica√ß√£o', check: () => !!document.getElementById('verificacaoModal') },
                { nome: 'Bot√£o de relat√≥rio', check: () => !!document.getElementById('btnRelatorio') },
                { nome: 'Se√ß√£o de relat√≥rio', check: () => !!document.getElementById('reportSection') }
            ];
            
            checklist.forEach(item => {
                try {
                    const resultado = item.check();
                    console.log(`${resultado ? '‚úÖ' : '‚ùå'} ${item.nome}: ${resultado ? 'OK' : 'FALHOU'}`);
                } catch (error) {
                    console.log(`‚ùå ${item.nome}: ERRO - ${error.message}`);
                }
            });
            
            console.log('üîç Verifica√ß√£o completa!');
            mostrarNotificacao('üîç Verifica√ß√£o do sistema completa - veja o console', 'info');
        };

        // === M√ìDULO DE FOTOS PARA FISCALIZA√á√ÉO (NOVO) ===
        let fotosFiscalizacao = {
            fachada: [],
            internas: [],
            documentos: [],
            acessibilidade: [],
            observacoes: []
        };
        let fotoTemporaria = null;

        // Abrir c√¢mera para tirar foto
        function abrirCameraFiscalizacao() {
            try {
                const input = document.getElementById('foto-input-hidden');
                input.accept = 'image/*';
                input.capture = 'environment'; // C√¢mera traseira
                input.multiple = false; // Uma foto por vez para descri√ß√£o
                
                input.onchange = function(e) {
                    if (e.target.files && e.target.files[0]) {
                        processarFotoCapturada(e.target.files[0]);
                    }
                };
                
                input.click();
                mostrarNotificacao('üì∑ C√¢mera ativada! Tire a foto.', 'info');
            } catch (error) {
                console.error('Erro ao abrir c√¢mera:', error);
                mostrarNotificacao('‚ùå Erro ao abrir c√¢mera', 'error');
            }
        }

        // Selecionar fotos existentes
        function selecionarFotosFiscalizacao() {
            try {
                const input = document.getElementById('foto-input-hidden');
                input.accept = 'image/*';
                input.capture = ''; // Galeria
                input.multiple = true; // M√∫ltiplas fotos
                
                input.onchange = function(e) {
                    if (e.target.files && e.target.files.length > 0) {
                        Array.from(e.target.files).forEach(file => {
                            processarFotoCapturada(file);
                        });
                    }
                };
                
                input.click();
                mostrarNotificacao('üìÅ Selecione as fotos da galeria', 'info');
            } catch (error) {
                console.error('Erro ao selecionar fotos:', error);
                mostrarNotificacao('‚ùå Erro ao selecionar fotos', 'error');
            }
        }

        // Processar foto capturada
        function processarFotoCapturada(file) {
            try {
                if (!file.type.startsWith('image/')) {
                    mostrarNotificacao('‚ùå Arquivo deve ser uma imagem', 'error');
                    return;
                }

                // Verificar tamanho (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    mostrarNotificacao('‚ùå Imagem muito grande. M√°ximo 5MB.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    fotoTemporaria = {
                        dataUrl: e.target.result,
                        arquivo: file,
                        timestamp: new Date().toLocaleString('pt-BR'),
                        tamanho: (file.size / 1024).toFixed(1) + ' KB'
                    };
                    
                    // Mostrar modal para descri√ß√£o
                    mostrarModalDescricao();
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('Erro ao processar foto:', error);
                mostrarNotificacao('‚ùå Erro ao processar foto', 'error');
            }
        }

        // Mostrar modal para adicionar descri√ß√£o
        function mostrarModalDescricao() {
            try {
                const modal = document.getElementById('modal-descricao-foto');
                const preview = document.getElementById('preview-foto-descricao');
                const descricaoInput = document.getElementById('descricao-foto-input');
                
                if (modal && preview && fotoTemporaria) {
                    preview.src = fotoTemporaria.dataUrl;
                    descricaoInput.value = '';
                    modal.style.display = 'block';
                }
            } catch (error) {
                console.error('Erro ao mostrar modal:', error);
            }
        }

        // Salvar foto com descri√ß√£o
        function salvarFotoComDescricao() {
            try {
                const categoria = document.getElementById('categoria-foto-select').value;
                const descricao = document.getElementById('descricao-foto-input').value.trim();
                
                if (!fotoTemporaria) {
                    mostrarNotificacao('‚ùå Nenhuma foto para salvar', 'error');
                    return;
                }

                const novaFoto = {
                    ...fotoTemporaria,
                    descricao: descricao || 'Sem descri√ß√£o',
                    categoria: categoria,
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 9)
                };

                // Adicionar √† categoria correspondente
                fotosFiscalizacao[categoria].push(novaFoto);
                
                // Atualizar interface
                renderizarFotoNaCategoria(novaFoto, categoria);
                atualizarContadorFotos();
                
                // Fechar modal
                cancelarDescricaoFoto();
                
                mostrarNotificacao(`üì∏ Foto adicionada em "${getCategoriaName(categoria)}"!`, 'success');
                
            } catch (error) {
                console.error('Erro ao salvar foto:', error);
                mostrarNotificacao('‚ùå Erro ao salvar foto', 'error');
            }
        }

        // Cancelar descri√ß√£o da foto
        function cancelarDescricaoFoto() {
            try {
                const modal = document.getElementById('modal-descricao-foto');
                if (modal) {
                    modal.style.display = 'none';
                }
                fotoTemporaria = null;
            } catch (error) {
                console.error('Erro ao cancelar:', error);
            }
        }

        // Adicionar foto diretamente a uma categoria
        function adicionarFotoCategoria(categoria) {
            try {
                const input = document.getElementById('foto-input-hidden');
                input.accept = 'image/*';
                input.capture = 'environment';
                input.multiple = true;
                
                input.onchange = function(e) {
                    if (e.target.files && e.target.files.length > 0) {
                        Array.from(e.target.files).forEach(file => {
                            processarFotoParaCategoria(file, categoria);
                        });
                    }
                };
                
                // Pr√©-selecionar categoria no modal
                document.getElementById('categoria-foto-select').value = categoria;
                input.click();
                
            } catch (error) {
                console.error('Erro ao adicionar foto √† categoria:', error);
            }
        }

        // Processar foto diretamente para categoria
        function processarFotoParaCategoria(file, categoria) {
            try {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const novaFoto = {
                        dataUrl: e.target.result,
                        arquivo: file,
                        timestamp: new Date().toLocaleString('pt-BR'),
                        tamanho: (file.size / 1024).toFixed(1) + ' KB',
                        descricao: `Foto ${fotosFiscalizacao[categoria].length + 1}`,
                        categoria: categoria,
                        id: Date.now() + '_' + Math.random().toString(36).substr(2, 9)
                    };

                    fotosFiscalizacao[categoria].push(novaFoto);
                    renderizarFotoNaCategoria(novaFoto, categoria);
                    atualizarContadorFotos();
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('Erro ao processar foto para categoria:', error);
            }
        }

        // Renderizar foto na interface
        function renderizarFotoNaCategoria(foto, categoria) {
            try {
                const grid = document.getElementById(`fotos-${categoria}`);
                if (!grid) return;

                const fotoDiv = document.createElement('div');
                fotoDiv.className = 'foto-item';
                fotoDiv.setAttribute('data-foto-id', foto.id);
                
                fotoDiv.innerHTML = `
                    <img src="${foto.dataUrl}" alt="${foto.descricao}">
                    <div class="foto-overlay">
                        <div>${foto.descricao}</div>
                        <div style="font-size: 10px; margin-top: 5px;">${foto.timestamp}</div>
                        <div style="font-size: 10px;">${foto.tamanho}</div>
                    </div>
                    <div class="foto-actions">
                        <button class="foto-btn" onclick="removerFoto('${foto.id}', '${categoria}')" title="Remover">üóëÔ∏è</button>
                        <button class="foto-btn" onclick="editarDescricaoFoto('${foto.id}', '${categoria}')" title="Editar">‚úèÔ∏è</button>
                    </div>
                `;

                grid.appendChild(fotoDiv);
            } catch (error) {
                console.error('Erro ao renderizar foto:', error);
            }
        }

        // Remover foto
        function removerFoto(fotoId, categoria) {
            try {
                if (confirm('Tem certeza que deseja remover esta foto?')) {
                    // Remover do array
                    fotosFiscalizacao[categoria] = fotosFiscalizacao[categoria].filter(foto => foto.id !== fotoId);
                    
                    // Remover da interface
                    const fotoElement = document.querySelector(`[data-foto-id="${fotoId}"]`);
                    if (fotoElement) {
                        fotoElement.remove();
                    }
                    
                    atualizarContadorFotos();
                    mostrarNotificacao('üóëÔ∏è Foto removida', 'info');
                }
            } catch (error) {
                console.error('Erro ao remover foto:', error);
            }
        }

        // Editar descri√ß√£o da foto
        function editarDescricaoFoto(fotoId, categoria) {
            try {
                const foto = fotosFiscalizacao[categoria].find(f => f.id === fotoId);
                if (!foto) return;

                const novaDescricao = prompt('Nova descri√ß√£o:', foto.descricao);
                if (novaDescricao !== null && novaDescricao.trim() !== '') {
                    foto.descricao = novaDescricao.trim();
                    
                    // Atualizar na interface
                    const fotoElement = document.querySelector(`[data-foto-id="${fotoId}"]`);
                    if (fotoElement) {
                        const overlay = fotoElement.querySelector('.foto-overlay div:first-child');
                        if (overlay) overlay.textContent = foto.descricao;
                    }
                    
                    mostrarNotificacao('‚úèÔ∏è Descri√ß√£o atualizada', 'success');
                }
            } catch (error) {
                console.error('Erro ao editar descri√ß√£o:', error);
            }
        }

        // Limpar todas as fotos
        function limparTodasFotos() {
            try {
                if (confirm('Tem certeza que deseja remover TODAS as fotos?')) {
                    // Limpar arrays
                    Object.keys(fotosFiscalizacao).forEach(categoria => {
                        fotosFiscalizacao[categoria] = [];
                        const grid = document.getElementById(`fotos-${categoria}`);
                        if (grid) grid.innerHTML = '';
                    });
                    
                    atualizarContadorFotos();
                    mostrarNotificacao('üóëÔ∏è Todas as fotos foram removidas', 'info');
                }
            } catch (error) {
                console.error('Erro ao limpar fotos:', error);
            }
        }

        // Atualizar contador de fotos
        function atualizarContadorFotos() {
            try {
                const total = Object.values(fotosFiscalizacao).reduce((acc, arr) => acc + arr.length, 0);
                const contador = document.getElementById('contador-fotos');
                if (contador) {
                    contador.textContent = `üìä ${total} foto${total !== 1 ? 's' : ''} adicionada${total !== 1 ? 's' : ''}`;
                }
            } catch (error) {
                console.error('Erro ao atualizar contador:', error);
            }
        }

        // Obter nome da categoria
        function getCategoriaName(categoria) {
            const nomes = {
                'fachada': 'üè¢ Fachada/√Årea Externa',
                'internas': 'üè† Depend√™ncias Internas',
                'documentos': 'üìã Documentos/Licen√ßas',
                'acessibilidade': '‚ôø Acessibilidade',
                'observacoes': 'üëÅÔ∏è Observa√ß√µes Gerais'
            };
            return nomes[categoria] || categoria;
        }

        // Fechar modal ao clicar fora (EXTENS√ÉO da fun√ß√£o existente)
        const originalWindowClick = window.onclick;
        window.onclick = function(event) {
            if (originalWindowClick) originalWindowClick(event);
            
            const modalFoto = document.getElementById('modal-descricao-foto');
            if (event.target === modalFoto) {
                cancelarDescricaoFoto();
            }
        };

        // Sistema de notifica√ß√µes
        function mostrarNotificacao(mensagem, tipo = 'info', duracao = 4000) {
            try {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                const icones = {
                    'success': '‚úÖ',
                    'error': '‚ùå', 
                    'info': '‚ÑπÔ∏è',
                    'warning': '‚ö†Ô∏è'
                };
                
                const icone = icones[tipo] || '‚ÑπÔ∏è';
                notification.innerHTML = `${icone} ${mensagem}`;
                notification.className = `notification ${tipo}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, duracao);
            } catch (error) {
                console.error('Erro ao mostrar notifica√ß√£o:', error);
            }
        }

        // Auto-save a cada 2 minutos
        setInterval(() => {
            try {
                const nomeConselheiroEl = document.getElementById('nome_conselheiro');
                if (nomeConselheiroEl && nomeConselheiroEl.value.trim()) {
                    salvarRascunho();
                    mostrarNotificacao('üíæ Auto-save realizado', 'info', 2000);
                }
            } catch (error) {
                console.error('Erro no auto-save:', error);
            }
        }, 120000);

        // Atalhos de teclado
        document.addEventListener('keydown', function(event) {
            try {
                if (event.ctrlKey && event.key === 's') {
                    event.preventDefault();
                    salvarRascunho();
                }
                
                if (event.ctrlKey && event.key === 'p') {
                    const reportSection = document.getElementById('reportSection');
                    if (reportSection && reportSection.style.display !== 'none') {
                        event.preventDefault();
                        gerarPDF();
                    }
                }
                
                if (event.key === 'Escape') {
                    fecharEmailModal();
                    fecharVerificacaoModal();
                }
            } catch (error) {
                console.error('Erro nos atalhos de teclado:', error);
            }
        });
    </script>
</body>
</html>
